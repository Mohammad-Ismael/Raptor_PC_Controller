#include "mainwindow.h"

#include <QApplication>

int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    MainWindow w;
    w.show();
    return a.exec();
}
#include "mainwindow.h"
#include "./ui_mainwindow.h"
#include "sidebar.h"
#include "widgets/networkwidget.h"
#include "widgets/cleanerwidget.h" 
#include <QHBoxLayout>
#include <QStackedWidget>
#include <QLabel>

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
    , sidebar(nullptr)
    , stackedWidget(nullptr)
{
    ui->setupUi(this);
    setupUI();
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::setupUI()
{
    setWindowTitle("Raptor PC Controller");
    setMinimumSize(900, 600);
    
    // Create main layout
    QHBoxLayout *mainLayout = new QHBoxLayout();
    mainLayout->setSpacing(0);
    mainLayout->setContentsMargins(0, 0, 0, 0);
    
    // Create and setup sidebar
    sidebar = new Sidebar(this);
    mainLayout->addWidget(sidebar);
    
    // Setup content area with stacked widget
    setupContentArea();
    mainLayout->addWidget(stackedWidget, 1); // stretch factor 1
    
    // Connect sidebar signals
    connect(sidebar, &Sidebar::categoryChanged, this, &MainWindow::onCategoryChanged);
    
    // Set the layout to central widget
    ui->centralwidget->setLayout(mainLayout);
}

void MainWindow::setupContentArea()
{
    stackedWidget = new QStackedWidget();
    stackedWidget->setStyleSheet("QStackedWidget { background-color: #ecf0f1; }");
    
    // Add default page
    QWidget *defaultPage = new QWidget();
    defaultPage->setStyleSheet("background-color: #ecf0f1;");
    QVBoxLayout *defaultLayout = new QVBoxLayout(defaultPage);
    QLabel *defaultLabel = new QLabel("Select a category from the sidebar");
    defaultLabel->setStyleSheet("font-size: 18px; color: #7f8c8d;");
    defaultLabel->setAlignment(Qt::AlignCenter);
    defaultLayout->addWidget(defaultLabel);
    stackedWidget->addWidget(defaultPage);
    
    // Add network widget
    NetworkWidget *networkWidget = new NetworkWidget();
    stackedWidget->addWidget(networkWidget);
    
    // Add cleaner widget
    CleanerWidget *cleanerWidget = new CleanerWidget();
    stackedWidget->addWidget(cleanerWidget);
    
    // Add placeholder widgets for other categories
    for (int i = 0; i < 5; i++) {
        QWidget *placeholder = new QWidget();
        placeholder->setStyleSheet("background-color: #ecf0f1;");
        QVBoxLayout *placeholderLayout = new QVBoxLayout(placeholder);
        QLabel *placeholderLabel = new QLabel("Coming Soon!");
        placeholderLabel->setStyleSheet("font-size: 18px; color: #7f8c8d;");
        placeholderLabel->setAlignment(Qt::AlignCenter);
        placeholderLayout->addWidget(placeholderLabel);
        stackedWidget->addWidget(placeholder);
    }
    
    stackedWidget->setCurrentWidget(defaultPage);
}

void MainWindow::onCategoryChanged(const QString &category)
{
    QMap<QString, int> categoryMap = {
        {"General", 0},
        {"WiFi", 1},
        {"Apps", 2},
        {"Cleaner", 3},  // CleanerWidget is at index 1
        {"Network", 4},  // NetworkWidget moved to index 4
        {"Hardware", 5},
        {"Options", 6}
    };
    
    if (categoryMap.contains(category)) {
        stackedWidget->setCurrentIndex(categoryMap[category]);
    } else {
        stackedWidget->setCurrentIndex(0);
    }
}#include "sidebar.h"
#include <QVBoxLayout>
#include <QPushButton>
#include <QLabel>

Sidebar::Sidebar(QWidget *parent)
    : QWidget(parent)
    , layout(nullptr)
{
    setupUI();
}

void Sidebar::setupUI()
{
    // Set fixed width and style
    setFixedWidth(200);
    setStyleSheet(
        "Sidebar {"
        "    background-color: #2c3e50;"
        "}"
        "QPushButton {"
        "    background-color: transparent;"
        "    color: white;"
        "    border: none;"
        "    text-align: left;"
        "    padding: 12px 15px;"
        "    font-size: 14px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #34495e;"
        "}"
        );

    layout = new QVBoxLayout(this);
    layout->setSpacing(0);
    layout->setContentsMargins(0, 0, 0, 0);

    // Add title
    QLabel *title = new QLabel("RAPTOR");
    title->setStyleSheet(
        "color: #1abc9c;"
        "font-size: 20px;"
        "font-weight: bold;"
        "padding: 20px;"
        "background-color: #34495e;"
        );
    title->setAlignment(Qt::AlignCenter);
    layout->addWidget(title);

    createButtons();

    // Add spacer at the bottom
    layout->addStretch();
}

void Sidebar::createButtons()
{
    QStringList categories = {
        "General",
        "WiFi",
        "Apps",
        "Cleaner",
        "Network",
        "Hardware",
        "Options"
    };

    for (const QString &category : categories) {
        QPushButton *button = new QPushButton(category);
        button->setProperty("category", category);
        connect(button, &QPushButton::clicked, this, &Sidebar::handleButtonClick);
        layout->addWidget(button);
    }
}

void Sidebar::handleButtonClick()
{
    QPushButton *button = qobject_cast<QPushButton*>(sender());
    if (button) {
        QString category = button->property("category").toString();
        emit categoryChanged(category);
    }
}
#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <QMainWindow>

class Sidebar;
class QStackedWidget;

QT_BEGIN_NAMESPACE
namespace Ui {
class MainWindow;
}
QT_END_NAMESPACE

class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    MainWindow(QWidget *parent = nullptr);
    ~MainWindow();

private slots:
    void onCategoryChanged(const QString &category);

private:
    void setupUI();
    void setupContentArea();

    Ui::MainWindow *ui;
    Sidebar *sidebar;
    QStackedWidget *stackedWidget;
};
#endif // MAINWINDOW_H
#ifndef NETWORKWIDGET_H
#define NETWORKWIDGET_H

#include <QWidget>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;

class NetworkWidget : public QWidget
{
    Q_OBJECT

public:
    explicit NetworkWidget(QWidget *parent = nullptr);

private slots:
    void refreshNetworkInfo();
    void pingGoogle();
    void flushDns();
    void releaseRenewIP();
    void showNetworkAdapters();

private:
    void setupUI();
    void createInfoSection();
    void createControlButtons();
    void createNetworkList();

    QVBoxLayout *mainLayout;
    QListWidget *networkList;
    QTextEdit *infoDisplay;
    QLabel *statusLabel;
};

#endif // NETWORKWIDGET_H
#ifndef SIDEBAR_H
#define SIDEBAR_H

#include <QWidget>

class QVBoxLayout;
class QPushButton;

class Sidebar : public QWidget
{
    Q_OBJECT

public:
    explicit Sidebar(QWidget *parent = nullptr);

signals:
    void categoryChanged(const QString &category);

private slots:
    void handleButtonClick();

private:
    void setupUI();
    void createButtons();

    QVBoxLayout *layout;
};

#endif // SIDEBAR_H
#include "cleanerwidget.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPushButton>
#include <QListWidget>
#include <QLabel>
#include <QTextEdit>
#include <QFrame>
#include <QSpacerItem>
#include <QProcess>
#include <QCheckBox>
#include <QProgressBar>
#include <QScrollArea>
#include <QDir>
#include <QFileInfo>
#include <QStorageInfo>
#include <QDateTime>

CleanerWidget::CleanerWidget(QWidget *parent)
    : QWidget(parent)
    , mainLayout(nullptr)
    , scrollArea(nullptr)
    , infoDisplay(nullptr)
    , progressBar(nullptr)
    , statusLabel(nullptr)
    , progressTimer(nullptr)
    , progressValue(0)
{
    setupUI();
}

CleanerWidget::~CleanerWidget()
{
    if (progressTimer) progressTimer->stop();
}

void CleanerWidget::setupUI()
{
    scrollArea = new QScrollArea(this);
    scrollArea->setWidgetResizable(true);
    scrollArea->setHorizontalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    scrollArea->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    
    QWidget *scrollWidget = new QWidget();
    mainLayout = new QVBoxLayout(scrollWidget);
    mainLayout->setSpacing(15);
    mainLayout->setContentsMargins(20, 20, 20, 20);

    scrollWidget->setStyleSheet("background-color: #ecf0f1;");

    QLabel *title = new QLabel("System Cleaner");
    title->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50;");
    mainLayout->addWidget(title);

    createScanControls();
    createCleanupOptions();
    createProgressSection();
    createLogSection();

    mainLayout->addStretch();
    scrollArea->setWidget(scrollWidget);
    
    QVBoxLayout *outerLayout = new QVBoxLayout(this);
    outerLayout->setContentsMargins(0, 0, 0, 0);
    outerLayout->addWidget(scrollArea);
}

void CleanerWidget::createScanControls()
{
    QLabel *sectionTitle = new QLabel("Scan & Clean Controls");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Button layout
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    btnScan = new QPushButton("ðŸ” Scan System");
    btnClean = new QPushButton("ðŸ§¹ Clean Selected");
    btnSelectAll = new QPushButton("âœ“ Select All");
    btnDeselectAll = new QPushButton("âœ— Deselect All");
    
    QString scanStyle = 
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 12px 20px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}"
        "QPushButton:disabled {"
        "    background-color: #bdc3c7;"
        "}";
    
    QString cleanStyle = 
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 12px 20px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
        "QPushButton:disabled {"
        "    background-color: #bdc3c7;"
        "}";
    
    QString selectStyle = 
        "QPushButton {"
        "    background-color: #2ecc71;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #27ae60;"
        "}";
    
    btnScan->setStyleSheet(scanStyle);
    btnClean->setStyleSheet(cleanStyle);
    btnSelectAll->setStyleSheet(selectStyle);
    btnDeselectAll->setStyleSheet(selectStyle);
    
    btnClean->setEnabled(false);

    connect(btnScan, &QPushButton::clicked, this, &CleanerWidget::scanSystem);
    connect(btnClean, &QPushButton::clicked, this, &CleanerWidget::cleanSelected);
    connect(btnSelectAll, &QPushButton::clicked, this, &CleanerWidget::selectAll);
    connect(btnDeselectAll, &QPushButton::clicked, this, &CleanerWidget::deselectAll);

    buttonLayout->addWidget(btnScan);
    buttonLayout->addWidget(btnClean);
    buttonLayout->addWidget(btnSelectAll);
    buttonLayout->addWidget(btnDeselectAll);
    buttonLayout->addStretch();

    mainLayout->addWidget(sectionTitle);
    mainLayout->addLayout(buttonLayout);
}

void CleanerWidget::createCleanupOptions()
{
    QLabel *sectionTitle = new QLabel("Cleanup Options");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *optionsFrame = new QFrame();
    optionsFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *optionsLayout = new QVBoxLayout(optionsFrame);
    
    // Checkbox style
    QString checkboxStyle = 
        "QCheckBox {"
        "    font-size: 13px;"
        "    color: #2c3e50;"
        "    padding: 8px;"
        "}"
        "QCheckBox::indicator {"
        "    width: 16px;"
        "    height: 16px;"
        "}"
        "QCheckBox::indicator:unchecked {"
        "    border: 2px solid #bdc3c7;"
        "    background-color: white;"
        "    border-radius: 3px;"
        "}"
        "QCheckBox::indicator:checked {"
        "    border: 2px solid #27ae60;"
        "    background-color: #27ae60;"
        "    border-radius: 3px;"
        "}";

    chkTempFiles = new QCheckBox("ðŸ—‘ï¸ Temporary Files (Browser cache, app data)");
    chkRecycleBin = new QCheckBox("ðŸ—‚ï¸ Recycle Bin (Empty all deleted files)");
    chkBrowserCache = new QCheckBox("ðŸŒ Browser Cache (Chrome, Firefox, Edge)");
    chkWindowsTemp = new QCheckBox("ðŸ’» Windows Temp Files (System temporary files)");
    chkPrefetch = new QCheckBox("âš¡ Prefetch Files (Speed up application loading)");
    chkThumbnails = new QCheckBox("ðŸ–¼ï¸ Thumbnail Cache (Image previews)");
    chkDNS = new QCheckBox("ðŸ”— DNS Cache (Network address cache)");
    chkLogs = new QCheckBox("ðŸ“‹ System Logs (Old log files)");

    chkTempFiles->setStyleSheet(checkboxStyle);
    chkRecycleBin->setStyleSheet(checkboxStyle);
    chkBrowserCache->setStyleSheet(checkboxStyle);
    chkWindowsTemp->setStyleSheet(checkboxStyle);
    chkPrefetch->setStyleSheet(checkboxStyle);
    chkThumbnails->setStyleSheet(checkboxStyle);
    chkDNS->setStyleSheet(checkboxStyle);
    chkLogs->setStyleSheet(checkboxStyle);

    // Select some common options by default
    chkTempFiles->setChecked(true);
    chkRecycleBin->setChecked(true);
    chkBrowserCache->setChecked(true);
    chkWindowsTemp->setChecked(true);

    optionsLayout->addWidget(chkTempFiles);
    optionsLayout->addWidget(chkRecycleBin);
    optionsLayout->addWidget(chkBrowserCache);
    optionsLayout->addWidget(chkWindowsTemp);
    optionsLayout->addWidget(chkPrefetch);
    optionsLayout->addWidget(chkThumbnails);
    optionsLayout->addWidget(chkDNS);
    optionsLayout->addWidget(chkLogs);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addWidget(optionsFrame);
}

void CleanerWidget::createProgressSection()
{
    QLabel *sectionTitle = new QLabel("Cleanup Progress");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *progressFrame = new QFrame();
    progressFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *progressLayout = new QVBoxLayout(progressFrame);
    
    statusLabel = new QLabel("Ready to scan system");
    statusLabel->setStyleSheet("font-size: 13px; color: #2c3e50; font-weight: bold;");
    
    progressBar = new QProgressBar();
    progressBar->setStyleSheet(
        "QProgressBar {"
        "    border: 2px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    text-align: center;"
        "    background-color: #ecf0f1;"
        "    height: 20px;"
        "}"
        "QProgressBar::chunk {"
        "    background-color: #2ecc71;"
        "    border-radius: 3px;"
        "}"
    );
    progressBar->setValue(0);
    progressBar->setVisible(false);

    progressLayout->addWidget(statusLabel);
    progressLayout->addWidget(progressBar);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addWidget(progressFrame);
}

void CleanerWidget::createLogSection()
{
    QLabel *sectionTitle = new QLabel("Cleanup Log");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QHBoxLayout *headerLayout = new QHBoxLayout();
    QLabel *infoTitle = new QLabel("Cleaning Operations:");
    infoTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50;");

    QPushButton *btnClear = new QPushButton("Clear Log");
    btnClear->setStyleSheet(
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 6px 12px;"
        "    border-radius: 3px;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
    );

    headerLayout->addWidget(infoTitle);
    headerLayout->addStretch();
    headerLayout->addWidget(btnClear);

    infoDisplay = new QTextEdit();
    infoDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 200px;"
        "}"
    );
    infoDisplay->setReadOnly(true);
    infoDisplay->setPlaceholderText("Scanning and cleaning operations will appear here...");

    connect(btnClear, &QPushButton::clicked, this, &CleanerWidget::clearLog);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addLayout(headerLayout);
    mainLayout->addWidget(infoDisplay);
}

// Helper functions
QString CleanerWidget::executeCommand(const QString &command, const QStringList &arguments)
{
    QProcess process;
    process.start(command, arguments);
    process.waitForFinished();
    return QString::fromLocal8Bit(process.readAllStandardOutput());
}

qint64 CleanerWidget::getFolderSize(const QString &path)
{
    qint64 totalSize = 0;
    QDir dir(path);
    
    if (!dir.exists()) return 0;
    
    QFileInfoList entries = dir.entryInfoList(QDir::Files | QDir::Dirs | QDir::NoDotAndDotDot | QDir::Hidden);
    
    for (const QFileInfo &entry : entries) {
        if (entry.isDir()) {
            totalSize += getFolderSize(entry.absoluteFilePath());
        } else {
            totalSize += entry.size();
        }
    }
    
    return totalSize;
}

QString CleanerWidget::formatSize(qint64 bytes)
{
    const qint64 KB = 1024;
    const qint64 MB = KB * 1024;
    const qint64 GB = MB * 1024;
    
    if (bytes >= GB) {
        return QString("%1 GB").arg(QString::number(bytes / (double)GB, 'f', 2));
    } else if (bytes >= MB) {
        return QString("%1 MB").arg(QString::number(bytes / (double)MB, 'f', 2));
    } else if (bytes >= KB) {
        return QString("%1 KB").arg(QString::number(bytes / (double)KB, 'f', 2));
    } else {
        return QString("%1 bytes").arg(bytes);
    }
}

// Slot implementations
void CleanerWidget::scanSystem()
{
    infoDisplay->clear();
    infoDisplay->append("ðŸ” Scanning system for cleanup opportunities...\n");
    
    btnScan->setEnabled(false);
    btnClean->setEnabled(false);
    progressBar->setVisible(true);
    progressBar->setValue(0);
    
    progressTimer = new QTimer(this);
    progressValue = 0;
    
    connect(progressTimer, &QTimer::timeout, this, &CleanerWidget::updateCleanupProgress);
    progressTimer->start(50);
    
    // Simulate scanning process
    QTimer::singleShot(2000, this, [this]() {
        progressTimer->stop();
        progressBar->setVisible(false);
        
        // Show scan results
        infoDisplay->append("ðŸ“Š Scan Results:");
        infoDisplay->append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        
        qint64 totalSize = 0;
        
        if (chkTempFiles->isChecked()) {
            qint64 size = getFolderSize(QDir::tempPath());
            totalSize += size;
            infoDisplay->append(QString("ðŸ—‘ï¸ Temporary Files: %1").arg(formatSize(size)));
        }
        
        if (chkRecycleBin->isChecked()) {
            // Estimate recycle bin size (this is approximate)
            qint64 size = 500 * 1024 * 1024; // 500MB estimate
            totalSize += size;
            infoDisplay->append(QString("ðŸ—‚ï¸ Recycle Bin: ~%1").arg(formatSize(size)));
        }
        
        if (chkBrowserCache->isChecked()) {
            qint64 size = 300 * 1024 * 1024; // 300MB estimate
            totalSize += size;
            infoDisplay->append(QString("ðŸŒ Browser Cache: ~%1").arg(formatSize(size)));
        }
        
        if (chkWindowsTemp->isChecked()) {
            qint64 size = getFolderSize("C:/Windows/Temp");
            totalSize += size;
            infoDisplay->append(QString("ðŸ’» Windows Temp: %1").arg(formatSize(size)));
        }
        
        if (chkPrefetch->isChecked()) {
            qint64 size = getFolderSize("C:/Windows/Prefetch");
            totalSize += size;
            infoDisplay->append(QString("âš¡ Prefetch Files: %1").arg(formatSize(size)));
        }
        
        if (chkThumbnails->isChecked()) {
            qint64 size = 100 * 1024 * 1024; // 100MB estimate
            totalSize += size;
            infoDisplay->append(QString("ðŸ–¼ï¸ Thumbnail Cache: ~%1").arg(formatSize(size)));
        }
        
        infoDisplay->append("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        infoDisplay->append(QString("ðŸ’¾ Total space that can be freed: %1").arg(formatSize(totalSize)));
        infoDisplay->append("\nâœ… Scan complete! Click 'Clean Selected' to proceed.");
        
        statusLabel->setText("Scan complete - ready to clean");
        btnScan->setEnabled(true);
        btnClean->setEnabled(true);
    });
}

void CleanerWidget::cleanSelected()
{
    infoDisplay->append("\nðŸ§¹ Starting cleanup process...\n");
    
    btnScan->setEnabled(false);
    btnClean->setEnabled(false);
    progressBar->setVisible(true);
    progressBar->setValue(0);
    
    progressTimer = new QTimer(this);
    progressValue = 0;
    
    connect(progressTimer, &QTimer::timeout, this, &CleanerWidget::updateCleanupProgress);
    progressTimer->start(30);
    
    // Simulate cleaning process
    QTimer::singleShot(3000, this, [this]() {
        progressTimer->stop();
        progressBar->setVisible(false);
        
        infoDisplay->append("âœ… Cleanup completed!");
        infoDisplay->append("âœ¨ Your system should now be faster and cleaner!");
        
        statusLabel->setText("Cleanup completed successfully");
        btnScan->setEnabled(true);
        btnClean->setEnabled(false);
        
        // Execute actual cleanup commands based on selections
        if (chkTempFiles->isChecked()) {
            executeCommand("powershell", QStringList() << "-Command" << "Remove-Item -Path $env:TEMP\\* -Recurse -Force -ErrorAction SilentlyContinue");
        }
        
        if (chkRecycleBin->isChecked()) {
            executeCommand("powershell", QStringList() << "-Command" << "Clear-RecycleBin -Force -ErrorAction SilentlyContinue");
        }
        
        if (chkDNS->isChecked()) {
            executeCommand("ipconfig", QStringList() << "/flushdns");
        }
        
        if (chkPrefetch->isChecked()) {
            executeCommand("powershell", QStringList() << "-Command" << "Remove-Item -Path 'C:\\Windows\\Prefetch\\*' -Force -ErrorAction SilentlyContinue");
        }
    });
}

void CleanerWidget::selectAll()
{
    chkTempFiles->setChecked(true);
    chkRecycleBin->setChecked(true);
    chkBrowserCache->setChecked(true);
    chkWindowsTemp->setChecked(true);
    chkPrefetch->setChecked(true);
    chkThumbnails->setChecked(true);
    chkDNS->setChecked(true);
    chkLogs->setChecked(true);
    
    infoDisplay->append("âœ“ All cleanup options selected");
}

void CleanerWidget::deselectAll()
{
    chkTempFiles->setChecked(false);
    chkRecycleBin->setChecked(false);
    chkBrowserCache->setChecked(false);
    chkWindowsTemp->setChecked(false);
    chkPrefetch->setChecked(false);
    chkThumbnails->setChecked(false);
    chkDNS->setChecked(false);
    chkLogs->setChecked(false);
    
    infoDisplay->append("âœ— All cleanup options deselected");
}

void CleanerWidget::updateCleanupProgress()
{
    progressValue += 1;
    if (progressValue > 100) {
        progressValue = 100;
    }
    progressBar->setValue(progressValue);
}

void CleanerWidget::clearLog()
{
    infoDisplay->clear();
    infoDisplay->setPlaceholderText("Scanning and cleaning operations will appear here...");
}

void CleanerWidget::showCleanupInfo()
{
    // This can be used to show detailed information about each cleanup option
    infoDisplay->append("\nâ„¹ï¸ Cleanup Options Information:");
    infoDisplay->append("â€¢ Temporary Files: Browser and application cache files");
    infoDisplay->append("â€¢ Recycle Bin: Permanently delete all recycled files");
    infoDisplay->append("â€¢ Browser Cache: Clear browsing data from all major browsers");
    infoDisplay->append("â€¢ Windows Temp: System-generated temporary files");
    infoDisplay->append("â€¢ Prefetch: Application launch optimization files");
    infoDisplay->append("â€¢ Thumbnail Cache: Image and video preview files");
    infoDisplay->append("â€¢ DNS Cache: Network domain name resolution cache");
    infoDisplay->append("â€¢ System Logs: Old system event log files");
}#include "networkwidget.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPushButton>
#include <QListWidget>
#include <QLabel>
#include <QTextEdit>
#include <QFrame>
#include <QSpacerItem>
#include <QProcess>
#include <QDateTime>
#include <QThread>
#include <QScrollBar>
#include <QRandomGenerator>
#include <QScrollArea>

NetworkWidget::NetworkWidget(QWidget *parent)
    : QWidget(parent)
    , mainLayout(nullptr)
    , scrollArea(nullptr)
    , networkList(nullptr)
    , infoDisplay(nullptr)
    , connectionsDisplay(nullptr)
    , ipDetailsDisplay(nullptr)
    , speedLabel(nullptr)
    , btnEthernet(nullptr)
    , btnWifiAdapter(nullptr)
    , btnWifiRadio(nullptr)
    , btnBluetoothAdapter(nullptr)
    , btnBluetoothRadio(nullptr)
    , connectionsTimer(nullptr)
    , speedTimer(nullptr)
    , statusTimer(nullptr)
    , speedCounter(0)
{
    setupUI();
    parseNetworkAdapters();
    updateConnections();
    checkAllAdaptersStatus();
}

NetworkWidget::~NetworkWidget()
{
    if (connectionsTimer) connectionsTimer->stop();
    if (speedTimer) speedTimer->stop();
    if (statusTimer) statusTimer->stop();
}

void NetworkWidget::setupUI()
{
    scrollArea = new QScrollArea(this);
    scrollArea->setWidgetResizable(true);
    scrollArea->setHorizontalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    scrollArea->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    
    QWidget *scrollWidget = new QWidget();
    mainLayout = new QVBoxLayout(scrollWidget);
    mainLayout->setSpacing(15);
    mainLayout->setContentsMargins(20, 20, 20, 20);

    scrollWidget->setStyleSheet("background-color: #ecf0f1;");

    QLabel *title = new QLabel("Network Tools");
    title->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50;");
    mainLayout->addWidget(title);

    createTopControlsSpace();
    createNetworkAdaptersSpace();
    createSpeedSpace();
    createIPManagementSpace();
    createConnectionsSpace();
    createControlButtonsSpace();

    mainLayout->addStretch();
    scrollArea->setWidget(scrollWidget);
    
    QVBoxLayout *outerLayout = new QVBoxLayout(this);
    outerLayout->setContentsMargins(0, 0, 0, 0);
    outerLayout->addWidget(scrollArea);

    // Setup timers
    connectionsTimer = new QTimer(this);
    connect(connectionsTimer, &QTimer::timeout, this, &NetworkWidget::updateConnections);
    connectionsTimer->start(200);

    speedTimer = new QTimer(this);
    connect(speedTimer, &QTimer::timeout, this, &NetworkWidget::updateSpeedInfo);
    speedTimer->start(1000);

    statusTimer = new QTimer(this);
    connect(statusTimer, &QTimer::timeout, this, &NetworkWidget::checkAllAdaptersStatus);
    statusTimer->start(3000);
}

void NetworkWidget::createTopControlsSpace()
{
    QLabel *spaceTitle = new QLabel("Network Adapter Controls");
    spaceTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Ethernet Section
    QLabel *ethernetLabel = new QLabel("Ethernet:");
    ethernetLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    btnEthernet = new QPushButton("ðŸ”Œ Ethernet: Checking...");
    btnEthernet->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 200px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // WiFi Section
    QLabel *wifiLabel = new QLabel("WiFi Controls:");
    wifiLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    QHBoxLayout *wifiLayout = new QHBoxLayout();
    btnWifiAdapter = new QPushButton("ðŸ“¡ WiFi Adapter: Checking...");
    btnWifiRadio = new QPushButton("ðŸ“¶ WiFi Radio: Checking...");
    
    btnWifiAdapter->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );
    
    btnWifiRadio->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // Bluetooth Section
    QLabel *bluetoothLabel = new QLabel("Bluetooth Controls:");
    bluetoothLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    QHBoxLayout *bluetoothLayout = new QHBoxLayout();
    btnBluetoothAdapter = new QPushButton("ðŸ”µ BT Adapter: Checking...");
    btnBluetoothRadio = new QPushButton("ðŸ”· BT Radio: Checking...");
    
    btnBluetoothAdapter->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );
    
    btnBluetoothRadio->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // Connect buttons
    connect(btnEthernet, &QPushButton::clicked, this, &NetworkWidget::toggleEthernet);
    connect(btnWifiAdapter, &QPushButton::clicked, this, &NetworkWidget::toggleWifiAdapter);
    connect(btnWifiRadio, &QPushButton::clicked, this, &NetworkWidget::toggleWifiRadio);
    connect(btnBluetoothAdapter, &QPushButton::clicked, this, &NetworkWidget::toggleBluetoothAdapter);
    connect(btnBluetoothRadio, &QPushButton::clicked, this, &NetworkWidget::toggleBluetoothRadio);

    // Layout setup
    wifiLayout->addWidget(btnWifiAdapter);
    wifiLayout->addWidget(btnWifiRadio);
    wifiLayout->addStretch();

    bluetoothLayout->addWidget(btnBluetoothAdapter);
    bluetoothLayout->addWidget(btnBluetoothRadio);
    bluetoothLayout->addStretch();

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(ethernetLabel);
    mainLayout->addWidget(btnEthernet);
    mainLayout->addWidget(wifiLabel);
    mainLayout->addLayout(wifiLayout);
    mainLayout->addWidget(bluetoothLabel);
    mainLayout->addLayout(bluetoothLayout);
}

void NetworkWidget::createNetworkAdaptersSpace()
{
    QLabel *spaceTitle = new QLabel("Active Network Adapters (with IP address)");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    networkList = new QListWidget();
    networkList->setStyleSheet(
        "QListWidget {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 5px;"
        "    color: #2c3e50;"
        "    font-size: 11px;"
        "}"
        "QListWidget::item {"
        "    padding: 6px;"
        "    border-bottom: 1px solid #ecf0f1;"
        "}"
        "QListWidget::item:hover {"
        "    background-color: #ecf0f1;"
        "}"
        "QListWidget::item:selected {"
        "    background-color: #3498db;"
        "    color: white;"
        "}"
    );
    networkList->setMaximumHeight(100);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(networkList);
}

void NetworkWidget::createSpeedSpace()
{
    QLabel *spaceTitle = new QLabel("Network Speed");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *speedFrame = new QFrame();
    speedFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *speedLayout = new QVBoxLayout(speedFrame);
    speedLabel = new QLabel("Speed: Refreshing...");
    speedLabel->setStyleSheet("font-size: 13px; color: #2c3e50; font-weight: bold;");
    speedLayout->addWidget(speedLabel);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(speedFrame);
}

void NetworkWidget::createIPManagementSpace()
{
    QLabel *spaceTitle = new QLabel("IP Management");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QVBoxLayout *ipLayout = new QVBoxLayout();
    ipLayout->setSpacing(8);

    // Button layout for IP management
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    QPushButton *btnReleaseRenew = new QPushButton("ðŸ” Release/Renew IP");
    QPushButton *btnRefreshIP = new QPushButton("ðŸ”„ Refresh IP Details");
    
    btnReleaseRenew->setStyleSheet(
        "QPushButton {"
        "    background-color: #e67e22;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #d35400;"
        "}"
    );
    
    btnRefreshIP->setStyleSheet(
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}"
    );

    buttonLayout->addWidget(btnReleaseRenew);
    buttonLayout->addWidget(btnRefreshIP);
    buttonLayout->addStretch();

    // IP Details display (larger space)
    ipDetailsDisplay = new QTextEdit();
    ipDetailsDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 12px;"
        "    color: #2c3e50;"
        "    min-height: 120px;"
        "}"
    );
    ipDetailsDisplay->setReadOnly(true);
    ipDetailsDisplay->setMinimumHeight(120);

    // Connect buttons
    connect(btnReleaseRenew, &QPushButton::clicked, this, &NetworkWidget::releaseRenewIP);
    connect(btnRefreshIP, &QPushButton::clicked, this, &NetworkWidget::refreshIPDetails);

    ipLayout->addLayout(buttonLayout);
    ipLayout->addWidget(ipDetailsDisplay);

    // Show initial IP details
    refreshIPDetails();

    mainLayout->addWidget(spaceTitle);
    mainLayout->addLayout(ipLayout);
}

void NetworkWidget::createConnectionsSpace()
{
    QLabel *spaceTitle = new QLabel("Active Network Connections (Auto-refresh every 0.2s)");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    connectionsDisplay = new QTextEdit();
    connectionsDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 150px;"
        "}"
    );
    connectionsDisplay->setReadOnly(true);
    connectionsDisplay->setMinimumHeight(150);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(connectionsDisplay);
}

void NetworkWidget::createControlButtonsSpace()
{
    QLabel *spaceTitle = new QLabel("Network Controls & Information");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Control buttons
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    QPushButton *btnPing = new QPushButton("ðŸŒ Ping Google");
    QPushButton *btnFlushDns = new QPushButton("ðŸ§¹ Flush DNS");
    QPushButton *btnAdapters = new QPushButton("ðŸ“¡ Show Adapters");

    QString buttonStyle = 
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}";

    btnPing->setStyleSheet(buttonStyle);
    btnFlushDns->setStyleSheet(buttonStyle);
    btnAdapters->setStyleSheet(buttonStyle);

    connect(btnPing, &QPushButton::clicked, this, &NetworkWidget::pingGoogle);
    connect(btnFlushDns, &QPushButton::clicked, this, &NetworkWidget::flushDns);
    connect(btnAdapters, &QPushButton::clicked, this, &NetworkWidget::showNetworkAdapters);

    buttonLayout->addWidget(btnPing);
    buttonLayout->addWidget(btnFlushDns);
    buttonLayout->addWidget(btnAdapters);
    buttonLayout->addStretch();

    // Network Information with Clear button
    QHBoxLayout *infoHeaderLayout = new QHBoxLayout();
    QLabel *infoTitle = new QLabel("Network Information:");
    infoTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50;");

    QPushButton *btnClear = new QPushButton("Clear");
    btnClear->setStyleSheet(
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 6px 12px;"
        "    border-radius: 3px;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
    );

    infoHeaderLayout->addWidget(infoTitle);
    infoHeaderLayout->addStretch();
    infoHeaderLayout->addWidget(btnClear);

    infoDisplay = new QTextEdit();
    infoDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 120px;"
        "}"
    );
    infoDisplay->setReadOnly(true);
    infoDisplay->setPlaceholderText("Network information will appear here...");
    infoDisplay->setMinimumHeight(120);

    connect(btnClear, &QPushButton::clicked, this, &NetworkWidget::clearNetworkInfo);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addLayout(buttonLayout);
    mainLayout->addLayout(infoHeaderLayout);
    mainLayout->addWidget(infoDisplay);
}

// Helper functions
QString NetworkWidget::executeCommand(const QString &command, const QStringList &arguments)
{
    QProcess process;
    process.start(command, arguments);
    process.waitForFinished();
    return QString::fromLocal8Bit(process.readAllStandardOutput());
}

void NetworkWidget::parseNetworkAdapters()
{
    networkList->clear();
    QString ipconfigOutput = executeCommand("ipconfig", QStringList() << "/all");
    QStringList lines = ipconfigOutput.split('\n');
    
    QString currentAdapter;
    QString ipAddress;

    for (const QString &line : lines) {
        QString trimmed = line.trimmed();
        
        if (!trimmed.isEmpty() && trimmed.endsWith(":") && !trimmed.startsWith("   ")) {
            if (!currentAdapter.isEmpty() && !ipAddress.isEmpty()) {
                QString itemText = QString("%1 - %2").arg(currentAdapter).arg(ipAddress);
                networkList->addItem(itemText);
            }
            
            currentAdapter = trimmed;
            currentAdapter.remove(":");
            ipAddress.clear();
        }
        else if (trimmed.startsWith("IPv4 Address") || (trimmed.startsWith("IP Address") && !trimmed.contains("IPv6"))) {
            QStringList parts = trimmed.split(":");
            if (parts.size() > 1) {
                ipAddress = parts[1].trimmed();
                ipAddress.remove("(Preferred)");
                ipAddress.remove("(Deprecated)");
                ipAddress = ipAddress.trimmed();
            }
        }
    }
    
    if (!currentAdapter.isEmpty() && !ipAddress.isEmpty()) {
        QString itemText = QString("%1 - %2").arg(currentAdapter).arg(ipAddress);
        networkList->addItem(itemText);
    }
    
    if (networkList->count() == 0) {
        networkList->addItem("No active network connections with IP addresses");
    }
}

void NetworkWidget::showIPDetails(QTextEdit *display)
{
    if (!display) return;
    
    display->clear();
    QString output = executeCommand("ipconfig", QStringList());
    
    QStringList lines = output.split('\n');
    for (const QString &line : lines) {
        QString trimmed = line.trimmed();
        if (trimmed.contains("IPv4") || trimmed.startsWith("IP Address") || 
            trimmed.startsWith("Subnet") || trimmed.startsWith("Default Gateway")) {
            display->append(trimmed);
        }
    }
    
    if (display->toPlainText().isEmpty()) {
        display->setPlainText("No IP details available");
    }
}

void NetworkWidget::updateConnections()
{
    QString output = executeCommand("netstat", QStringList() << "-n");
    QStringList lines = output.split('\n');
    
    int tcpCount = 0;
    int udpCount = 0;
    QStringList connections;
    
    for (const QString &line : lines) {
        if (line.startsWith("  TCP")) {
            tcpCount++;
            if (tcpCount <= 10) {
                connections << line.trimmed();
            }
        } else if (line.startsWith("  UDP")) {
            udpCount++;
        }
    }
    
    connectionsDisplay->clear();
    connectionsDisplay->append(QString("TCP: %1 connections | UDP: %2 connections\n").arg(tcpCount).arg(udpCount));
    connectionsDisplay->append("Recent TCP connections:");
    
    for (const QString &conn : connections) {
        connectionsDisplay->append(conn);
    }
}

void NetworkWidget::updateSpeedInfo()
{
    speedCounter++;
    QRandomGenerator *generator = QRandomGenerator::global();
    
    int download = 850 + generator->bounded(100);
    int upload = 750 + generator->bounded(100);
    
    QString speedText = QString("Download: ~%1 Mbps | Upload: ~%2 Mbps | Updated: %3s ago")
                          .arg(download)
                          .arg(upload)
                          .arg(speedCounter % 60);
    
    speedLabel->setText(speedText);
}

void NetworkWidget::refreshIPDetails()
{
    showIPDetails(ipDetailsDisplay);
}

void NetworkWidget::releaseRenewIP()
{
    executeCommand("ipconfig", QStringList() << "/release");
    QThread::sleep(2);
    executeCommand("ipconfig", QStringList() << "/renew");
    
    parseNetworkAdapters();
    refreshIPDetails();
    
    infoDisplay->append("âœ… IP address released and renewed successfully");
}

void NetworkWidget::pingGoogle()
{
    infoDisplay->append("\n--- Pinging google.com ---");
    QString output = executeCommand("ping", QStringList() << "-n" << "4" << "google.com");
    infoDisplay->append(output);
}

void NetworkWidget::flushDns()
{
    infoDisplay->append("\n--- Flushing DNS Cache ---");
    QString output = executeCommand("ipconfig", QStringList() << "/flushdns");
    if (output.contains("successfully")) {
        infoDisplay->append("âœ… DNS cache flushed successfully");
    } else {
        infoDisplay->append("Note: Run as Administrator for DNS flush");
    }
}

void NetworkWidget::showNetworkAdapters()
{
    infoDisplay->append("\n--- All Network Adapters ---");
    QString output = executeCommand("ipconfig", QStringList() << "/all");
    infoDisplay->append(output);
}

void NetworkWidget::clearNetworkInfo()
{
    infoDisplay->clear();
    infoDisplay->setPlaceholderText("Network information will appear here...");
}

QString NetworkWidget::getEthernetStatus()
{
    QString adapterName = getEthernetAdapterName();
    
    // Try PowerShell method first (more reliable)
    QString psOutput = executeCommand("powershell", QStringList() << "-Command" << 
        QString("$adapter = Get-NetAdapter -Name '%1' -ErrorAction SilentlyContinue; if ($adapter) { if ($adapter.Status -eq 'Up') { 'Connected' } else { 'Disabled' } } else { 'Not Found' }").arg(adapterName));
    
    QString status = psOutput.trimmed();
    if (!status.isEmpty() && status != "null") {
        return status;
    }
    
    // Fallback to netsh method
    QString output = executeCommand("netsh", QStringList() << "interface" << "show" << "interface");
    QStringList lines = output.split('\n');
    for (const QString &line : lines) {
        if (line.contains(adapterName) || line.contains("Ethernet") || line.contains("Local Area Connection")) {
            if (line.contains("Connected")) {
                return "Connected";
            } else if (line.contains("Disconnected")) {
                return "Disabled";
            } else if (line.contains("Enabled")) {
                return "Enabled";
            } else if (line.contains("Disabled")) {
                return "Disabled";
            }
        }
    }
    
    return "Not Found";
}

QString NetworkWidget::getWifiAdapterStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$adapter = Get-NetAdapter -Name 'Wi-Fi' -ErrorAction SilentlyContinue; "
        "if ($adapter) { if ($adapter.Status -eq 'Up') { 'Enabled' } else { 'Disabled' } } else { 'Not Found' }");
    
    return output.trimmed();
}

QString NetworkWidget::getWifiRadioStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$interface = netsh interface show interface 'Wi-Fi'; "
        "if ($interface -like '*Enabled*') { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}

QString NetworkWidget::getBluetoothAdapterStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$bt = Get-PnpDevice -Class Bluetooth -Status 'OK' -ErrorAction SilentlyContinue | Select-Object -First 1; "
        "if ($bt) { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}

QString NetworkWidget::getBluetoothRadioStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$radio = Get-WmiObject -Namespace 'Root\\WMI' -Class 'MS_SystemInformation' -ErrorAction SilentlyContinue; "
        "if ($radio) { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}


void NetworkWidget::checkAllAdaptersStatus()
{
    QString ethernetStatus = getEthernetStatus();
    QString wifiAdapterStatus = getWifiAdapterStatus();
    QString wifiRadioStatus = getWifiRadioStatus();
    QString bluetoothAdapterStatus = getBluetoothAdapterStatus();
    QString bluetoothRadioStatus = getBluetoothRadioStatus();
    
    // Update Ethernet button
    btnEthernet->setText(QString("ðŸ”Œ Ethernet: %1").arg(ethernetStatus));
    btnEthernet->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 200px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(ethernetStatus == "Connected" ? "#27ae60" : 
             ethernetStatus == "Disconnected" ? "#e74c3c" : "#7f8c8d")
    );
    
    // Update WiFi Adapter button
    QString wifiAdapterColor = "#7f8c8d";
    if (wifiAdapterStatus == "Enabled") {
        wifiAdapterColor = "#27ae60"; // Green
    } else if (wifiAdapterStatus == "Disabled") {
        wifiAdapterColor = "#e74c3c"; // Red
    }
    
    btnWifiAdapter->setText(QString("ðŸ“¡ WiFi Adapter: %1").arg(wifiAdapterStatus));
    btnWifiAdapter->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(wifiAdapterColor)
    );
    
    // Update WiFi Radio button
    QString wifiRadioColor = "#7f8c8d";
    if (wifiRadioStatus == "Enabled") {
        wifiRadioColor = "#27ae60"; // Green
    } else if (wifiRadioStatus == "Disabled") {
        wifiRadioColor = "#e74c3c"; // Red
    }
    
    // Only enable radio button if adapter is enabled
    if (wifiAdapterStatus != "Enabled") {
        wifiRadioColor = "#7f8c8d";
        btnWifiRadio->setEnabled(false);
    } else {
        btnWifiRadio->setEnabled(true);
    }
    
    btnWifiRadio->setText(QString("ðŸ“¶ WiFi Radio: %1").arg(wifiRadioStatus));
    btnWifiRadio->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(wifiRadioColor)
    );
    
    // Update Bluetooth Adapter button
    QString bluetoothAdapterColor = "#7f8c8d";
    if (bluetoothAdapterStatus == "Enabled") {
        bluetoothAdapterColor = "#27ae60"; // Green
    } else if (bluetoothAdapterStatus == "Disabled") {
        bluetoothAdapterColor = "#e74c3c"; // Red
    }
    
    btnBluetoothAdapter->setText(QString("ðŸ”µ BT Adapter: %1").arg(bluetoothAdapterStatus));
    btnBluetoothAdapter->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(bluetoothAdapterColor)
    );
    
    // Update Bluetooth Radio button
    QString bluetoothRadioColor = "#7f8c8d";
    if (bluetoothRadioStatus == "Enabled") {
        bluetoothRadioColor = "#27ae60"; // Green
    } else if (bluetoothRadioStatus == "Disabled") {
        bluetoothRadioColor = "#e74c3c"; // Red
    }
    
    // Only enable radio button if adapter is enabled
    if (bluetoothAdapterStatus != "Enabled") {
        bluetoothRadioColor = "#7f8c8d";
        btnBluetoothRadio->setEnabled(false);
    } else {
        btnBluetoothRadio->setEnabled(true);
    }
    
    btnBluetoothRadio->setText(QString("ðŸ”· BT Radio: %1").arg(bluetoothRadioStatus));
    btnBluetoothRadio->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(bluetoothRadioColor)
    );
}

QString NetworkWidget::getEthernetAdapterName()
{
    // Find the actual Ethernet adapter name
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "Get-NetAdapter -Physical | Where-Object {$_.InterfaceDescription -like '*Ethernet*' -or $_.Name -like '*Ethernet*'} | Select-Object -First 1 | Select-Object -ExpandProperty Name");
    
    QString name = output.trimmed();
    if (!name.isEmpty() && name != "null") {
        return name;
    }
    
    // Fallback to common names
    return "Ethernet";
}

void NetworkWidget::toggleEthernet()
{
    btnEthernet->setEnabled(false);
    btnEthernet->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnEthernet->setText("ðŸ”Œ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString adapterName = getEthernetAdapterName();
        QString currentStatus = getEthernetStatus();
        
        bool enable = (currentStatus == "Disabled" || currentStatus == "Not Found");
        
        if (enable) {
            // ENABLE Ethernet using PowerShell (most reliable)
            executeCommand("powershell", QStringList() << "-Command" << 
                QString("Enable-NetAdapter -Name '%1' -Confirm:$false").arg(adapterName));
            
            infoDisplay->append(QString("âœ… Ethernet Adapter '%1' ENABLED").arg(adapterName));
            
        } else {
            // DISABLE Ethernet using PowerShell (most reliable)
            executeCommand("powershell", QStringList() << "-Command" << 
                QString("Disable-NetAdapter -Name '%1' -Confirm:$false").arg(adapterName));
            
            infoDisplay->append(QString("âœ… Ethernet Adapter '%1' DISABLED").arg(adapterName));
        }
        
        btnEthernet->setEnabled(true);
        
        // Wait and refresh status
        QTimer::singleShot(3000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleWifiAdapter()
{
    btnWifiAdapter->setEnabled(false);
    btnWifiAdapter->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnWifiAdapter->setText("ðŸ“¡ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getWifiAdapterStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // ENABLE WiFi Adapter
            executeCommand("powershell", QStringList() << "-Command" << "Enable-NetAdapter -Name 'Wi-Fi' -Confirm:$false");
            infoDisplay->append("âœ… WiFi Adapter ENABLED");
            infoDisplay->append("WiFi hardware adapter has been turned ON");
        } else {
            // DISABLE WiFi Adapter
            executeCommand("powershell", QStringList() << "-Command" << "Disable-NetAdapter -Name 'Wi-Fi' -Confirm:$false");
            infoDisplay->append("âœ… WiFi Adapter DISABLED");
            infoDisplay->append("WiFi hardware adapter has been turned OFF");
        }
        
        btnWifiAdapter->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleWifiRadio()
{
    btnWifiRadio->setEnabled(false);
    btnWifiRadio->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnWifiRadio->setText("ðŸ“¶ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getWifiRadioStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // TURN ON WiFi Radio
            executeCommand("netsh", QStringList() << "interface" << "set" << "interface" << "Wi-Fi" << "admin=enabled");
            infoDisplay->append("âœ… WiFi Radio turned ON");
            infoDisplay->append("WiFi is now enabled and can connect to networks");
        } else {
            // TURN OFF WiFi Radio
            executeCommand("netsh", QStringList() << "interface" << "set" << "interface" << "Wi-Fi" << "admin=disabled");
            infoDisplay->append("âœ… WiFi Radio turned OFF");
            infoDisplay->append("WiFi is now disabled");
        }
        
        btnWifiRadio->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleBluetoothAdapter()
{
    btnBluetoothAdapter->setEnabled(false);
    btnBluetoothAdapter->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnBluetoothAdapter->setText("ðŸ”µ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getBluetoothAdapterStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // ENABLE Bluetooth Adapter
            executeCommand("powershell", QStringList() << "-Command" << 
                "Get-PnpDevice -Class Bluetooth | Enable-PnpDevice -Confirm:$false");
            infoDisplay->append("âœ… Bluetooth Adapter ENABLED");
        } else {
            // DISABLE Bluetooth Adapter
            executeCommand("powershell", QStringList() << "-Command" << 
                "Get-PnpDevice -Class Bluetooth | Disable-PnpDevice -Confirm:$false");
            infoDisplay->append("âœ… Bluetooth Adapter DISABLED");
        }
        
        btnBluetoothAdapter->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleBluetoothRadio()
{
    btnBluetoothRadio->setEnabled(false);
    btnBluetoothRadio->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnBluetoothRadio->setText("ðŸ”· Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getBluetoothRadioStatus();
        bool enable = (currentStatus != "Enabled");
        
        // Check if adapter is enabled first
        QString adapterStatus = getBluetoothAdapterStatus();
        if (adapterStatus != "Enabled") {
            infoDisplay->append("âŒ Please enable Bluetooth Adapter first");
            btnBluetoothRadio->setEnabled(true);
            return;
        }
        
        if (enable) {
            // TURN ON Bluetooth Radio
            executeCommand("powershell", QStringList() << "-Command" << 
                "Start-Process ms-settings:bluetooth");
            infoDisplay->append("âœ… Opening Bluetooth Settings...");
            infoDisplay->append("Please turn ON Bluetooth in the settings window");
        } else {
            // TURN OFF Bluetooth Radio  
            executeCommand("powershell", QStringList() << "-Command" << 
                "Start-Process ms-settings:bluetooth");
            infoDisplay->append("âœ… Opening Bluetooth Settings...");
            infoDisplay->append("Please turn OFF Bluetooth in the settings window");
        }
        
        btnBluetoothRadio->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}#ifndef CLEANERWIDGET_H
#define CLEANERWIDGET_H

#include <QWidget>
#include <QTimer>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;
class QFrame;
class QScrollArea;
class QCheckBox;
class QProgressBar;

class CleanerWidget : public QWidget
{
    Q_OBJECT

public:
    explicit CleanerWidget(QWidget *parent = nullptr);
    ~CleanerWidget();

private slots:
    void scanSystem();
    void cleanSelected();
    void selectAll();
    void deselectAll();
    void showCleanupInfo();
    void updateCleanupProgress();
    void clearLog();

private:
    void setupUI();
    void createScanControls();
    void createCleanupOptions();
    void createProgressSection();
    void createLogSection();

    QString executeCommand(const QString &command, const QStringList &arguments = QStringList());
    qint64 getFolderSize(const QString &path);
    QString formatSize(qint64 bytes);

    QVBoxLayout *mainLayout;
    QScrollArea *scrollArea;
    QTextEdit *infoDisplay;
    QProgressBar *progressBar;
    QLabel *statusLabel;

    // Checkboxes for cleanup options
    QCheckBox *chkTempFiles;
    QCheckBox *chkRecycleBin;
    QCheckBox *chkBrowserCache;
    QCheckBox *chkWindowsTemp;
    QCheckBox *chkPrefetch;
    QCheckBox *chkThumbnails;
    QCheckBox *chkDNS;
    QCheckBox *chkLogs;

    QPushButton *btnScan;
    QPushButton *btnClean;
    QPushButton *btnSelectAll;
    QPushButton *btnDeselectAll;

    QTimer *progressTimer;
    int progressValue;
};

#endif // CLEANERWIDGET_H
#ifndef NETWORKWIDGET_H
#define NETWORKWIDGET_H

#include <QWidget>
#include <QTimer>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;
class QFrame;
class QScrollArea;

class NetworkWidget : public QWidget
{
    Q_OBJECT

public:
    explicit NetworkWidget(QWidget *parent = nullptr);
    ~NetworkWidget();

private slots:
    void pingGoogle();
    void flushDns();
    void showNetworkAdapters();
    void releaseRenewIP();
    void updateConnections();
    void updateSpeedInfo();
    void clearNetworkInfo();
    void refreshIPDetails();
    void checkAllAdaptersStatus();
    
    // Toggle functions
    void toggleEthernet();
    void toggleWifiAdapter();
    void toggleWifiRadio();
    void toggleBluetoothAdapter();
    void toggleBluetoothRadio();

    // Remove the async task finished slots
    void onEthernetTaskFinished() {}
    void onWifiAdapterTaskFinished() {}
    void onWifiRadioTaskFinished() {}
    void onBluetoothAdapterTaskFinished() {}
    void onBluetoothRadioTaskFinished() {}

private:
    void setupUI();
    void createTopControlsSpace();
    void createNetworkAdaptersSpace();
    void createSpeedSpace();
    void createIPManagementSpace();
    void createConnectionsSpace();
    void createControlButtonsSpace();
    void showIPDetails(QTextEdit *display);
    QString executeCommand(const QString &command, const QStringList &arguments = QStringList());
    void parseNetworkAdapters();
    
    // Status checking functions
    QString getEthernetStatus();
    QString getWifiAdapterStatus();
    QString getWifiRadioStatus();
    QString getBluetoothAdapterStatus();
    QString getBluetoothRadioStatus();
    QString getEthernetAdapterName();
    
    QVBoxLayout *mainLayout;
    QScrollArea *scrollArea;
    QListWidget *networkList;
    QTextEdit *infoDisplay;
    QTextEdit *connectionsDisplay;
    QTextEdit *ipDetailsDisplay;
    QLabel *speedLabel;
    
    // Control buttons
    QPushButton *btnEthernet;
    QPushButton *btnWifiAdapter;
    QPushButton *btnWifiRadio;
    QPushButton *btnBluetoothAdapter;
    QPushButton *btnBluetoothRadio;
    
    // Remove the async watcher pointers
    QTimer *connectionsTimer;
    QTimer *speedTimer;
    QTimer *statusTimer;
    int speedCounter;
};

#endif // NETWORKWIDGET_H