#include "mainwindow.h"

#include <QApplication>

int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    MainWindow w;
    w.show();
    return a.exec();
}
#include "mainwindow.h"
#include "./ui_mainwindow.h"
#include "sidebar.h"
#include "widgets/networkwidget.h"
#include "widgets/cleanerwidget.h" 
#include <QHBoxLayout>
#include <QStackedWidget>
#include <QLabel>

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
    , sidebar(nullptr)
    , stackedWidget(nullptr)
    , networkLoaded(false)
    , cleanerLoaded(false)
{
    ui->setupUi(this);
    setupUI();
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::setupUI()
{
    setWindowTitle("Raptor PC Controller");
    setMinimumSize(900, 600);
    
    // Create main layout
    QHBoxLayout *mainLayout = new QHBoxLayout();
    mainLayout->setSpacing(0);
    mainLayout->setContentsMargins(0, 0, 0, 0);
    
    // Create and setup sidebar
    sidebar = new Sidebar(this);
    mainLayout->addWidget(sidebar);
    
    // Setup content area with stacked widget
    setupContentArea();
    mainLayout->addWidget(stackedWidget, 1); // stretch factor 1
    
    // Connect sidebar signals
    connect(sidebar, &Sidebar::categoryChanged, this, &MainWindow::onCategoryChanged);
    
    // Set the layout to central widget
    ui->centralwidget->setLayout(mainLayout);
    
    // Show General page by default
    showGeneralPage();
}

void MainWindow::setupContentArea()
{
    stackedWidget = new QStackedWidget();
    stackedWidget->setStyleSheet("QStackedWidget { background-color: #ecf0f1; }");
    
    // Add placeholder pages - they will be replaced when needed
    for (int i = 0; i < 7; i++) {
        QWidget *placeholder = new QWidget();
        placeholder->setStyleSheet("background-color: #ecf0f1;");
        QVBoxLayout *placeholderLayout = new QVBoxLayout(placeholder);
        QLabel *placeholderLabel = new QLabel("Loading...");
        placeholderLabel->setStyleSheet("font-size: 18px; color: #7f8c8d;");
        placeholderLabel->setAlignment(Qt::AlignCenter);
        placeholderLayout->addWidget(placeholderLabel);
        stackedWidget->addWidget(placeholder);
    }
}

void MainWindow::onCategoryChanged(const QString &category)
{
    if (category == "General") {
        showGeneralPage();
    } else if (category == "Network") {
        showNetworkPage();
    } else if (category == "Cleaner") {
        showCleanerPage();
    } else {
        showPlaceholderPage(category);
    }
}

void MainWindow::showGeneralPage()
{
    // Create or show General page
    if (stackedWidget->count() > 0) {
        QWidget *generalPage = new QWidget();
        generalPage->setStyleSheet("background-color: #ecf0f1;");
        QVBoxLayout *generalLayout = new QVBoxLayout(generalPage);
        
        QLabel *welcomeLabel = new QLabel("Welcome to Raptor PC Controller");
        welcomeLabel->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50; margin-bottom: 20px;");
        welcomeLabel->setAlignment(Qt::AlignCenter);
        
        QLabel *descriptionLabel = new QLabel(
            "This tool helps you manage your PC's network settings, clean up system files, "
            "and optimize performance.\n\n"
            "Select a category from the sidebar to get started."
        );
        descriptionLabel->setStyleSheet("font-size: 14px; color: #7f8c8d; text-align: center; line-height: 1.5;");
        descriptionLabel->setAlignment(Qt::AlignCenter);
        descriptionLabel->setWordWrap(true);
        
        generalLayout->addStretch();
        generalLayout->addWidget(welcomeLabel);
        generalLayout->addWidget(descriptionLabel);
        generalLayout->addStretch();
        
        if (stackedWidget->count() > 0) {
            delete stackedWidget->widget(0); // Remove old widget
            stackedWidget->insertWidget(0, generalPage);
        }
        stackedWidget->setCurrentIndex(0);
    }
}

void MainWindow::showNetworkPage()
{
    if (!networkLoaded) {
        // Load Network widget only when needed
        NetworkWidget *networkWidget = new NetworkWidget();
        if (stackedWidget->count() > 4) {
            delete stackedWidget->widget(4); // Remove old widget
            stackedWidget->insertWidget(4, networkWidget);
        }
        networkLoaded = true;
    }
    stackedWidget->setCurrentIndex(4);
}

void MainWindow::showCleanerPage()
{
    if (!cleanerLoaded) {
        // Load Cleaner widget only when needed
        CleanerWidget *cleanerWidget = new CleanerWidget();
        if (stackedWidget->count() > 3) {
            delete stackedWidget->widget(3); // Remove old widget
            stackedWidget->insertWidget(3, cleanerWidget);
        }
        cleanerLoaded = true;
    }
    stackedWidget->setCurrentIndex(3);
}

void MainWindow::showPlaceholderPage(const QString &title)
{
    // Show placeholder for other categories
    QWidget *placeholder = new QWidget();
    placeholder->setStyleSheet("background-color: #ecf0f1;");
    QVBoxLayout *placeholderLayout = new QVBoxLayout(placeholder);
    
    QLabel *titleLabel = new QLabel(title + " - Coming Soon!");
    titleLabel->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50; margin-bottom: 20px;");
    titleLabel->setAlignment(Qt::AlignCenter);
    
    QLabel *descriptionLabel = new QLabel(
        "This feature is under development and will be available in a future update.\n\n"
        "Check back soon for new functionality!"
    );
    descriptionLabel->setStyleSheet("font-size: 14px; color: #7f8c8d; text-align: center;");
    descriptionLabel->setAlignment(Qt::AlignCenter);
    descriptionLabel->setWordWrap(true);
    
    placeholderLayout->addStretch();
    placeholderLayout->addWidget(titleLabel);
    placeholderLayout->addWidget(descriptionLabel);
    placeholderLayout->addStretch();
    
    // Map categories to indices
    QMap<QString, int> categoryIndices = {
        {"WiFi", 1},
        {"Apps", 2},
        {"Hardware", 5},
        {"Options", 6}
    };
    
    if (categoryIndices.contains(title)) {
        int index = categoryIndices[title];
        if (stackedWidget->count() > index) {
            delete stackedWidget->widget(index);
            stackedWidget->insertWidget(index, placeholder);
        }
        stackedWidget->setCurrentIndex(index);
    }
}#include "sidebar.h"
#include <QVBoxLayout>
#include <QPushButton>
#include <QLabel>

Sidebar::Sidebar(QWidget *parent)
    : QWidget(parent)
    , layout(nullptr)
{
    setupUI();
}

void Sidebar::setupUI()
{
    // Set fixed width and style
    setFixedWidth(200);
    setStyleSheet(
        "Sidebar {"
        "    background-color: #2c3e50;"
        "}"
        "QPushButton {"
        "    background-color: transparent;"
        "    color: white;"
        "    border: none;"
        "    text-align: left;"
        "    padding: 12px 15px;"
        "    font-size: 14px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #34495e;"
        "}"
        );

    layout = new QVBoxLayout(this);
    layout->setSpacing(0);
    layout->setContentsMargins(0, 0, 0, 0);

    // Add title
    QLabel *title = new QLabel("RAPTOR");
    title->setStyleSheet(
        "color: #1abc9c;"
        "font-size: 20px;"
        "font-weight: bold;"
        "padding: 20px;"
        "background-color: #34495e;"
        );
    title->setAlignment(Qt::AlignCenter);
    layout->addWidget(title);

    createButtons();

    // Add spacer at the bottom
    layout->addStretch();
}

void Sidebar::createButtons()
{
    QStringList categories = {
        "General",
        "WiFi",
        "Apps",
        "Cleaner",
        "Network",
        "Hardware",
        "Options"
    };

    for (const QString &category : categories) {
        QPushButton *button = new QPushButton(category);
        button->setProperty("category", category);
        connect(button, &QPushButton::clicked, this, &Sidebar::handleButtonClick);
        layout->addWidget(button);
    }
}

void Sidebar::handleButtonClick()
{
    QPushButton *button = qobject_cast<QPushButton*>(sender());
    if (button) {
        QString category = button->property("category").toString();
        emit categoryChanged(category);
    }
}
#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include <QMainWindow>

class Sidebar;
class QStackedWidget;
class QWidget;

QT_BEGIN_NAMESPACE
namespace Ui {
class MainWindow;
}
QT_END_NAMESPACE

class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    MainWindow(QWidget *parent = nullptr);
    ~MainWindow();

private slots:
    void onCategoryChanged(const QString &category);

private:
    void setupUI();
    void setupContentArea();
    void showGeneralPage();
    void showNetworkPage();
    void showCleanerPage();
    void showPlaceholderPage(const QString &title);

    Ui::MainWindow *ui;
    Sidebar *sidebar;
    QStackedWidget *stackedWidget;
    
    // Track which pages are loaded
    bool networkLoaded;
    bool cleanerLoaded;
};
#endif // MAINWINDOW_H#ifndef NETWORKWIDGET_H
#define NETWORKWIDGET_H

#include <QWidget>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;

class NetworkWidget : public QWidget
{
    Q_OBJECT

public:
    explicit NetworkWidget(QWidget *parent = nullptr);

private slots:
    void refreshNetworkInfo();
    void pingGoogle();
    void flushDns();
    void releaseRenewIP();
    void showNetworkAdapters();

private:
    void setupUI();
    void createInfoSection();
    void createControlButtons();
    void createNetworkList();

    QVBoxLayout *mainLayout;
    QListWidget *networkList;
    QTextEdit *infoDisplay;
    QLabel *statusLabel;
};

#endif // NETWORKWIDGET_H
#ifndef SIDEBAR_H
#define SIDEBAR_H

#include <QWidget>

class QVBoxLayout;
class QPushButton;

class Sidebar : public QWidget
{
    Q_OBJECT

public:
    explicit Sidebar(QWidget *parent = nullptr);

signals:
    void categoryChanged(const QString &category);

private slots:
    void handleButtonClick();

private:
    void setupUI();
    void createButtons();

    QVBoxLayout *layout;
};

#endif // SIDEBAR_H
#include "cleanerwidget.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPushButton>
#include <QListWidget>
#include <QLabel>
#include <QTextEdit>
#include <QFrame>
#include <QSpacerItem>
#include <QProcess>
#include <QCheckBox>
#include <QProgressBar>
#include <QScrollArea>
#include <QDir>
#include <QFileInfo>
#include <QStorageInfo>
#include <QDateTime>
#include <QStandardPaths>

CleanerWidget::CleanerWidget(QWidget *parent)
    : QWidget(parent)
    , mainLayout(nullptr)
    , scrollArea(nullptr)
    , infoDisplay(nullptr)
    , progressBar(nullptr)
    , statusLabel(nullptr)
    , progressTimer(nullptr)
    , progressValue(0)
    , tempFilesSize(0)
    , recycleBinSize(0)
    , browserCacheSize(0)
    , windowsTempSize(0)
    , prefetchSize(0)
    , thumbnailsSize(0)
    , logsSize(0)
{
    setupUI();
}

CleanerWidget::~CleanerWidget()
{
    if (progressTimer) progressTimer->stop();
}

void CleanerWidget::setupUI()
{
    scrollArea = new QScrollArea(this);
    scrollArea->setWidgetResizable(true);
    scrollArea->setHorizontalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    scrollArea->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    
    QWidget *scrollWidget = new QWidget();
    mainLayout = new QVBoxLayout(scrollWidget);
    mainLayout->setSpacing(15);
    mainLayout->setContentsMargins(20, 20, 20, 20);

    scrollWidget->setStyleSheet("background-color: #ecf0f1;");

    QLabel *title = new QLabel("System Cleaner");
    title->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50;");
    mainLayout->addWidget(title);

    createScanControls();
    createCleanupOptions();
    createProgressSection();
    createLogSection();

    mainLayout->addStretch();
    scrollArea->setWidget(scrollWidget);
    
    QVBoxLayout *outerLayout = new QVBoxLayout(this);
    outerLayout->setContentsMargins(0, 0, 0, 0);
    outerLayout->addWidget(scrollArea);
}

void CleanerWidget::createScanControls()
{
    QLabel *sectionTitle = new QLabel("Scan & Clean Controls");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Button layout
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    btnScan = new QPushButton("üîç Scan System");
    btnClean = new QPushButton("üßπ Clean Selected");
    btnSelectAll = new QPushButton("‚úì Select All");
    btnDeselectAll = new QPushButton("‚úó Deselect All");
    
    QString scanStyle = 
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 12px 20px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}"
        "QPushButton:disabled {"
        "    background-color: #bdc3c7;"
        "}";
    
    QString cleanStyle = 
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 12px 20px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
        "QPushButton:disabled {"
        "    background-color: #bdc3c7;"
        "}";
    
    QString selectStyle = 
        "QPushButton {"
        "    background-color: #2ecc71;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #27ae60;"
        "}"
        "QPushButton:disabled {"
        "    background-color: #bdc3c7;"
        "}";
    
    btnScan->setStyleSheet(scanStyle);
    btnClean->setStyleSheet(cleanStyle);
    btnSelectAll->setStyleSheet(selectStyle);
    btnDeselectAll->setStyleSheet(selectStyle);
    
    // Initially disable all buttons except scan
    btnClean->setEnabled(false);
    btnSelectAll->setEnabled(false);
    btnDeselectAll->setEnabled(false);

    connect(btnScan, &QPushButton::clicked, this, &CleanerWidget::scanSystem);
    connect(btnClean, &QPushButton::clicked, this, &CleanerWidget::cleanSelected);
    connect(btnSelectAll, &QPushButton::clicked, this, &CleanerWidget::selectAll);
    connect(btnDeselectAll, &QPushButton::clicked, this, &CleanerWidget::deselectAll);

    buttonLayout->addWidget(btnScan);
    buttonLayout->addWidget(btnClean);
    buttonLayout->addWidget(btnSelectAll);
    buttonLayout->addWidget(btnDeselectAll);
    buttonLayout->addStretch();

    mainLayout->addWidget(sectionTitle);
    mainLayout->addLayout(buttonLayout);
}

void CleanerWidget::createCleanupOptions()
{
    QLabel *sectionTitle = new QLabel("Cleanup Options - Scan first to see file sizes");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *optionsFrame = new QFrame();
    optionsFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *optionsLayout = new QVBoxLayout(optionsFrame);
    
    // Checkbox style
    QString checkboxStyle = 
        "QCheckBox {"
        "    font-size: 13px;"
        "    color: #2c3e50;"
        "    padding: 8px;"
        "}"
        "QCheckBox::indicator {"
        "    width: 16px;"
        "    height: 16px;"
        "}"
        "QCheckBox::indicator:unchecked {"
        "    border: 2px solid #bdc3c7;"
        "    background-color: white;"
        "    border-radius: 3px;"
        "}"
        "QCheckBox::indicator:checked {"
        "    border: 2px solid #27ae60;"
        "    background-color: #27ae60;"
        "    border-radius: 3px;"
        "}"
        "QCheckBox:disabled {"
        "    color: #95a5a6;"
        "}";

    chkTempFiles = new QCheckBox("üóëÔ∏è Temporary Files (Not scanned yet)");
    chkRecycleBin = new QCheckBox("üóÇÔ∏è Recycle Bin (Not scanned yet)");
    chkBrowserCache = new QCheckBox("üåê Browser Cache (Not scanned yet)");
    chkWindowsTemp = new QCheckBox("üíª Windows Temp Files (Not scanned yet)");
    chkPrefetch = new QCheckBox("‚ö° Prefetch Files (Not scanned yet)");
    chkThumbnails = new QCheckBox("üñºÔ∏è Thumbnail Cache (Not scanned yet)");
    chkDNS = new QCheckBox("üîó DNS Cache");
    chkLogs = new QCheckBox("üìã System Logs (Not scanned yet)");

    chkTempFiles->setStyleSheet(checkboxStyle);
    chkRecycleBin->setStyleSheet(checkboxStyle);
    chkBrowserCache->setStyleSheet(checkboxStyle);
    chkWindowsTemp->setStyleSheet(checkboxStyle);
    chkPrefetch->setStyleSheet(checkboxStyle);
    chkThumbnails->setStyleSheet(checkboxStyle);
    chkDNS->setStyleSheet(checkboxStyle);
    chkLogs->setStyleSheet(checkboxStyle);

    // Initially disable all checkboxes and uncheck them
    chkTempFiles->setEnabled(false);
    chkRecycleBin->setEnabled(false);
    chkBrowserCache->setEnabled(false);
    chkWindowsTemp->setEnabled(false);
    chkPrefetch->setEnabled(false);
    chkThumbnails->setEnabled(false);
    chkDNS->setEnabled(false);
    chkLogs->setEnabled(false);
    
    chkTempFiles->setChecked(false);
    chkRecycleBin->setChecked(false);
    chkBrowserCache->setChecked(false);
    chkWindowsTemp->setChecked(false);
    chkPrefetch->setChecked(false);
    chkThumbnails->setChecked(false);
    chkDNS->setChecked(false);
    chkLogs->setChecked(false);

    optionsLayout->addWidget(chkTempFiles);
    optionsLayout->addWidget(chkRecycleBin);
    optionsLayout->addWidget(chkBrowserCache);
    optionsLayout->addWidget(chkWindowsTemp);
    optionsLayout->addWidget(chkPrefetch);
    optionsLayout->addWidget(chkThumbnails);
    optionsLayout->addWidget(chkDNS);
    optionsLayout->addWidget(chkLogs);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addWidget(optionsFrame);
}

void CleanerWidget::createProgressSection()
{
    QLabel *sectionTitle = new QLabel("Cleanup Progress");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *progressFrame = new QFrame();
    progressFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *progressLayout = new QVBoxLayout(progressFrame);
    
    statusLabel = new QLabel("Click 'Scan System' to start");
    statusLabel->setStyleSheet("font-size: 13px; color: #2c3e50; font-weight: bold;");
    
    progressBar = new QProgressBar();
    progressBar->setStyleSheet(
        "QProgressBar {"
        "    border: 2px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    text-align: center;"
        "    background-color: #ecf0f1;"
        "    height: 20px;"
        "}"
        "QProgressBar::chunk {"
        "    background-color: #2ecc71;"
        "    border-radius: 3px;"
        "}"
    );
    progressBar->setValue(0);
    progressBar->setVisible(false);

    progressLayout->addWidget(statusLabel);
    progressLayout->addWidget(progressBar);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addWidget(progressFrame);
}

void CleanerWidget::createLogSection()
{
    QLabel *sectionTitle = new QLabel("Cleanup Log");
    sectionTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QHBoxLayout *headerLayout = new QHBoxLayout();
    QLabel *infoTitle = new QLabel("Cleaning Operations:");
    infoTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50;");

    QPushButton *btnClear = new QPushButton("Clear Log");
    btnClear->setStyleSheet(
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 6px 12px;"
        "    border-radius: 3px;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
    );

    headerLayout->addWidget(infoTitle);
    headerLayout->addStretch();
    headerLayout->addWidget(btnClear);

    infoDisplay = new QTextEdit();
    infoDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 200px;"
        "}"
    );
    infoDisplay->setReadOnly(true);
    infoDisplay->setPlaceholderText("Click 'Scan System' to analyze your system for cleanup opportunities...");

    connect(btnClear, &QPushButton::clicked, this, &CleanerWidget::clearLog);

    mainLayout->addWidget(sectionTitle);
    mainLayout->addLayout(headerLayout);
    mainLayout->addWidget(infoDisplay);
}

// Helper functions
QString CleanerWidget::executeCommand(const QString &command, const QStringList &arguments)
{
    QProcess process;
    process.start(command, arguments);
    process.waitForFinished();
    return QString::fromLocal8Bit(process.readAllStandardOutput());
}

qint64 CleanerWidget::getFolderSize(const QString &path)
{
    qint64 totalSize = 0;
    QDir dir(path);
    
    if (!dir.exists()) return 0;
    
    QFileInfoList entries = dir.entryInfoList(QDir::Files | QDir::Dirs | QDir::NoDotAndDotDot | QDir::Hidden | QDir::System);
    
    for (const QFileInfo &entry : entries) {
        if (entry.isDir()) {
            totalSize += getFolderSize(entry.absoluteFilePath());
        } else {
            totalSize += entry.size();
        }
    }
    
    return totalSize;
}

QString CleanerWidget::formatSize(qint64 bytes)
{
    const qint64 KB = 1024;
    const qint64 MB = KB * 1024;
    const qint64 GB = MB * 1024;
    
    if (bytes >= GB) {
        return QString("%1 GB").arg(QString::number(bytes / (double)GB, 'f', 2));
    } else if (bytes >= MB) {
        return QString("%1 MB").arg(QString::number(bytes / (double)MB, 'f', 2));
    } else if (bytes >= KB) {
        return QString("%1 KB").arg(QString::number(bytes / (double)KB, 'f', 2));
    } else {
        return QString("%1 bytes").arg(bytes);
    }
}

void CleanerWidget::updateCheckboxText(QCheckBox* checkbox, const QString& baseText, qint64 size)
{
    QString newText = QString("%1 (%2)").arg(baseText).arg(formatSize(size));
    checkbox->setText(newText);
}

// Slot implementations
void CleanerWidget::scanSystem()
{
    infoDisplay->clear();
    infoDisplay->append("üîç Scanning system for cleanup opportunities...\n");
    infoDisplay->append("This may take a few moments depending on your system.\n");
    
    btnScan->setEnabled(false);
    btnClean->setEnabled(false);
    btnSelectAll->setEnabled(false);
    btnDeselectAll->setEnabled(false);
    progressBar->setVisible(true);
    progressBar->setValue(0);
    
    progressTimer = new QTimer(this);
    progressValue = 0;
    
    connect(progressTimer, &QTimer::timeout, this, &CleanerWidget::updateCleanupProgress);
    progressTimer->start(50);
    
    // Reset all sizes
    tempFilesSize = 0;
    recycleBinSize = 0;
    browserCacheSize = 0;
    windowsTempSize = 0;
    prefetchSize = 0;
    thumbnailsSize = 0;
    logsSize = 0;

    // Actual scanning process
    QTimer::singleShot(100, this, [this]() {
        infoDisplay->append("üìÅ Scanning temporary files...");
        tempFilesSize = getFolderSize(QDir::tempPath());
        
        infoDisplay->append("üóÇÔ∏è Estimating recycle bin size...");
        // Estimate recycle bin size by checking common locations
        recycleBinSize = 500 * 1024 * 1024; // Conservative 500MB estimate
        
        infoDisplay->append("üåê Scanning browser cache...");
        QString chromeCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Google/Chrome";
        QString firefoxCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Mozilla/Firefox";
        QString edgeCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Microsoft/Edge";
        
        browserCacheSize += getFolderSize(chromeCache);
        browserCacheSize += getFolderSize(firefoxCache);
        browserCacheSize += getFolderSize(edgeCache);
        
        infoDisplay->append("üíª Scanning Windows temp files...");
        windowsTempSize = getFolderSize("C:/Windows/Temp");
        
        infoDisplay->append("‚ö° Scanning prefetch files...");
        prefetchSize = getFolderSize("C:/Windows/Prefetch");
        
        infoDisplay->append("üñºÔ∏è Scanning thumbnail cache...");
        QString thumbPath = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Microsoft/Windows/Explorer";
        thumbnailsSize = getFolderSize(thumbPath);
        
        infoDisplay->append("üìã Scanning log files...");
        logsSize = getFolderSize("C:/Windows/Logs");
        
        // Complete scanning
        progressTimer->stop();
        progressBar->setVisible(false);
        
        // Update checkbox texts with sizes
        updateCheckboxText(chkTempFiles, "üóëÔ∏è Temporary Files", tempFilesSize);
        updateCheckboxText(chkRecycleBin, "üóÇÔ∏è Recycle Bin", recycleBinSize);
        updateCheckboxText(chkBrowserCache, "üåê Browser Cache", browserCacheSize);
        updateCheckboxText(chkWindowsTemp, "üíª Windows Temp Files", windowsTempSize);
        updateCheckboxText(chkPrefetch, "‚ö° Prefetch Files", prefetchSize);
        updateCheckboxText(chkThumbnails, "üñºÔ∏è Thumbnail Cache", thumbnailsSize);
        updateCheckboxText(chkLogs, "üìã System Logs", logsSize);
        
        // Enable checkboxes and control buttons
        chkTempFiles->setEnabled(true);
        chkRecycleBin->setEnabled(true);
        chkBrowserCache->setEnabled(true);
        chkWindowsTemp->setEnabled(true);
        chkPrefetch->setEnabled(true);
        chkThumbnails->setEnabled(true);
        chkDNS->setEnabled(true);
        chkLogs->setEnabled(true);
        
        btnSelectAll->setEnabled(true);
        btnDeselectAll->setEnabled(true);
        
        // Show scan results
        infoDisplay->append("\nüìä Scan Results:");
        infoDisplay->append("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
        infoDisplay->append(QString("üóëÔ∏è Temporary Files: %1").arg(formatSize(tempFilesSize)));
        infoDisplay->append(QString("üóÇÔ∏è Recycle Bin: ~%1").arg(formatSize(recycleBinSize)));
        infoDisplay->append(QString("üåê Browser Cache: %1").arg(formatSize(browserCacheSize)));
        infoDisplay->append(QString("üíª Windows Temp: %1").arg(formatSize(windowsTempSize)));
        infoDisplay->append(QString("‚ö° Prefetch Files: %1").arg(formatSize(prefetchSize)));
        infoDisplay->append(QString("üñºÔ∏è Thumbnail Cache: %1").arg(formatSize(thumbnailsSize)));
        infoDisplay->append(QString("üìã System Logs: %1").arg(formatSize(logsSize)));
        
        qint64 totalSize = tempFilesSize + recycleBinSize + browserCacheSize + 
                          windowsTempSize + prefetchSize + thumbnailsSize + logsSize;
        
        infoDisplay->append("‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ");
        infoDisplay->append(QString("üíæ Total space that can be freed: %1").arg(formatSize(totalSize)));
        infoDisplay->append("\n‚úÖ Scan complete! Select the items you want to clean and click 'Clean Selected'.");
        
        statusLabel->setText("Scan complete - select items to clean");
        btnScan->setEnabled(true);
    });
}

void CleanerWidget::cleanSelected()
{
    // Check if any options are selected
    bool anySelected = chkTempFiles->isChecked() || chkRecycleBin->isChecked() || 
                      chkBrowserCache->isChecked() || chkWindowsTemp->isChecked() ||
                      chkPrefetch->isChecked() || chkThumbnails->isChecked() ||
                      chkDNS->isChecked() || chkLogs->isChecked();
    
    if (!anySelected) {
        infoDisplay->append("\n‚ùå Please select at least one cleanup option!");
        return;
    }
    
    infoDisplay->append("\nüßπ Starting cleanup process...\n");
    
    btnScan->setEnabled(false);
    btnClean->setEnabled(false);
    btnSelectAll->setEnabled(false);
    btnDeselectAll->setEnabled(false);
    progressBar->setVisible(true);
    progressBar->setValue(0);
    
    progressTimer = new QTimer(this);
    progressValue = 0;
    
    connect(progressTimer, &QTimer::timeout, this, &CleanerWidget::updateCleanupProgress);
    progressTimer->start(30);
    
    // Use a list to track cleanup operations
    QStringList cleanupOperations;
    
    if (chkTempFiles->isChecked()) {
        cleanupOperations << "temp";
    }
    if (chkRecycleBin->isChecked()) {
        cleanupOperations << "recycle";
    }
    if (chkBrowserCache->isChecked()) {
        cleanupOperations << "browser";
    }
    if (chkWindowsTemp->isChecked()) {
        cleanupOperations << "wintemp";
    }
    if (chkPrefetch->isChecked()) {
        cleanupOperations << "prefetch";
    }
    if (chkThumbnails->isChecked()) {
        cleanupOperations << "thumbnails";
    }
    if (chkDNS->isChecked()) {
        cleanupOperations << "dns";
    }
    if (chkLogs->isChecked()) {
        cleanupOperations << "logs";
    }
    
    // Process cleanup operations one by one
    processCleanupOperations(cleanupOperations, 0);
}

void CleanerWidget::processCleanupOperations(const QStringList &operations, int index)
{
    if (index >= operations.size()) {
        // All operations completed
        progressTimer->stop();
        progressBar->setValue(100);
        
        QTimer::singleShot(500, this, [this]() {
            progressBar->setVisible(false);
            infoDisplay->append("\n‚úÖ Cleanup completed successfully!");
            infoDisplay->append("‚ú® Your system should now be faster and cleaner!");
            statusLabel->setText("Cleanup completed successfully");
            
            btnScan->setEnabled(true);
            btnSelectAll->setEnabled(true);
            btnDeselectAll->setEnabled(true);
            // Keep Clean button disabled until next scan
        });
        return;
    }
    
    QString operation = operations[index];
    int progressStep = (index + 1) * (100 / operations.size());
    
    // Update progress
    progressValue = progressStep - (100 / operations.size());
    progressBar->setValue(progressValue);
    
    // Execute the cleanup operation
    if (operation == "temp") {
        cleanTempFiles();
    } else if (operation == "recycle") {
        cleanRecycleBin();
    } else if (operation == "browser") {
        cleanBrowserCache();
    } else if (operation == "wintemp") {
        cleanWindowsTemp();
    } else if (operation == "prefetch") {
        cleanPrefetch();
    } else if (operation == "thumbnails") {
        cleanThumbnails();
    } else if (operation == "dns") {
        cleanDNS();
    } else if (operation == "logs") {
        cleanLogs();
    }
    
    // Process next operation after a delay
    QTimer::singleShot(1000, this, [this, operations, index]() {
        processCleanupOperations(operations, index + 1);
    });
}

void CleanerWidget::cleanTempFiles()
{
    infoDisplay->append("üóëÔ∏è Cleaning temporary files...");
    
    // Clean user temp files
    QString tempPath = QDir::tempPath();
    QDir tempDir(tempPath);
    
    if (tempDir.exists()) {
        QFileInfoList files = tempDir.entryInfoList(QDir::Files | QDir::Dirs | QDir::NoDotAndDotDot);
        int deletedCount = 0;
        
        for (const QFileInfo &file : files) {
            if (file.isDir()) {
                QDir dir(file.absoluteFilePath());
                if (dir.removeRecursively()) {
                    deletedCount++;
                }
            } else {
                if (QFile::remove(file.absoluteFilePath())) {
                    deletedCount++;
                }
            }
        }
        infoDisplay->append(QString("   ‚úì Deleted %1 temporary files/folders").arg(deletedCount));
    }
}

void CleanerWidget::cleanRecycleBin()
{
    infoDisplay->append("üóÇÔ∏è Emptying recycle bin...");
    
    // Use PowerShell to clear recycle bin
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "Clear-RecycleBin -Force -ErrorAction SilentlyContinue; Write-Output 'Recycle bin cleared'");
    
    if (output.contains("cleared")) {
        infoDisplay->append("   ‚úì Recycle bin emptied");
    } else {
        infoDisplay->append("   ‚ö†Ô∏è Recycle bin may require administrator rights");
    }
}

void CleanerWidget::cleanBrowserCache()
{
    infoDisplay->append("üåê Clearing browser cache...");
    
    int cleanedCount = 0;
    
    // Chrome cache
    QString chromeCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Google/Chrome";
    if (QDir(chromeCache).exists()) {
        QDir(chromeCache).removeRecursively();
        cleanedCount++;
    }
    
    // Firefox cache
    QString firefoxCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Mozilla/Firefox";
    if (QDir(firefoxCache).exists()) {
        QDir(firefoxCache).removeRecursively();
        cleanedCount++;
    }
    
    // Edge cache
    QString edgeCache = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Microsoft/Edge";
    if (QDir(edgeCache).exists()) {
        QDir(edgeCache).removeRecursively();
        cleanedCount++;
    }
    
    infoDisplay->append(QString("   ‚úì Cleared cache for %1 browsers").arg(cleanedCount));
}

void CleanerWidget::cleanWindowsTemp()
{
    infoDisplay->append("üíª Cleaning Windows temp files...");
    
    QDir winTempDir("C:/Windows/Temp");
    if (winTempDir.exists()) {
        int deletedCount = 0;
        QFileInfoList files = winTempDir.entryInfoList(QDir::Files | QDir::NoDotAndDotDot);
        
        for (const QFileInfo &file : files) {
            if (QFile::remove(file.absoluteFilePath())) {
                deletedCount++;
            }
        }
        infoDisplay->append(QString("   ‚úì Deleted %1 Windows temp files").arg(deletedCount));
    }
}

void CleanerWidget::cleanPrefetch()
{
    infoDisplay->append("‚ö° Cleaning prefetch files...");
    
    QDir prefetchDir("C:/Windows/Prefetch");
    if (prefetchDir.exists()) {
        int deletedCount = 0;
        QFileInfoList files = prefetchDir.entryInfoList(QStringList() << "*.pf", QDir::Files | QDir::NoDotAndDotDot);
        
        for (const QFileInfo &file : files) {
            if (QFile::remove(file.absoluteFilePath())) {
                deletedCount++;
            }
        }
        infoDisplay->append(QString("   ‚úì Deleted %1 prefetch files").arg(deletedCount));
    }
}

void CleanerWidget::cleanThumbnails()
{
    infoDisplay->append("üñºÔ∏è Clearing thumbnail cache...");
    
    QString thumbPath = QStandardPaths::writableLocation(QStandardPaths::GenericCacheLocation) + "/Microsoft/Windows/Explorer";
    QDir thumbDir(thumbPath);
    
    if (thumbDir.exists()) {
        int deletedCount = 0;
        QFileInfoList files = thumbDir.entryInfoList(QStringList() << "thumbcache_*.db", QDir::Files);
        
        for (const QFileInfo &file : files) {
            if (QFile::remove(file.absoluteFilePath())) {
                deletedCount++;
            }
        }
        infoDisplay->append(QString("   ‚úì Deleted %1 thumbnail cache files").arg(deletedCount));
    }
}

void CleanerWidget::cleanDNS()
{
    infoDisplay->append("üîó Flushing DNS cache...");
    
    QString output = executeCommand("ipconfig", QStringList() << "/flushdns");
    if (output.contains("successfully")) {
        infoDisplay->append("   ‚úì DNS cache flushed successfully");
    } else {
        infoDisplay->append("   ‚ö†Ô∏è DNS flush may require administrator rights");
    }
}

void CleanerWidget::cleanLogs()
{
    infoDisplay->append("üìã Cleaning log files...");
    
    QDir logsDir("C:/Windows/Logs");
    if (logsDir.exists()) {
        int deletedCount = 0;
        
        // Only delete log files in subdirectories, not the directories themselves
        QFileInfoList entries = logsDir.entryInfoList(QDir::Dirs | QDir::NoDotAndDotDot);
        for (const QFileInfo &entry : entries) {
            if (entry.isDir()) {
                QDir subDir(entry.absoluteFilePath());
                QFileInfoList files = subDir.entryInfoList(QDir::Files);
                for (const QFileInfo &file : files) {
                    if (QFile::remove(file.absoluteFilePath())) {
                        deletedCount++;
                    }
                }
            }
        }
        infoDisplay->append(QString("   ‚úì Deleted %1 log files").arg(deletedCount));
    }
}

void CleanerWidget::selectAll()
{
    chkTempFiles->setChecked(true);
    chkRecycleBin->setChecked(true);
    chkBrowserCache->setChecked(true);
    chkWindowsTemp->setChecked(true);
    chkPrefetch->setChecked(true);
    chkThumbnails->setChecked(true);
    chkDNS->setChecked(true);
    chkLogs->setChecked(true);
    
    infoDisplay->append("‚úì All cleanup options selected");
    btnClean->setEnabled(true);
}

void CleanerWidget::deselectAll()
{
    chkTempFiles->setChecked(false);
    chkRecycleBin->setChecked(false);
    chkBrowserCache->setChecked(false);
    chkWindowsTemp->setChecked(false);
    chkPrefetch->setChecked(false);
    chkThumbnails->setChecked(false);
    chkDNS->setChecked(false);
    chkLogs->setChecked(false);
    
    infoDisplay->append("‚úó All cleanup options deselected");
    btnClean->setEnabled(false);
}

void CleanerWidget::updateCleanupProgress()
{
    progressValue += 1;
    if (progressValue > 100) {
        progressValue = 100;
    }
    progressBar->setValue(progressValue);
}

void CleanerWidget::clearLog()
{
    infoDisplay->clear();
    infoDisplay->setPlaceholderText("Click 'Scan System' to analyze your system for cleanup opportunities...");
}#include "networkwidget.h"
#include <QVBoxLayout>
#include <QHBoxLayout>
#include <QPushButton>
#include <QListWidget>
#include <QLabel>
#include <QTextEdit>
#include <QFrame>
#include <QSpacerItem>
#include <QProcess>
#include <QDateTime>
#include <QThread>
#include <QScrollBar>
#include <QRandomGenerator>
#include <QScrollArea>

NetworkWidget::NetworkWidget(QWidget *parent)
    : QWidget(parent)
    , mainLayout(nullptr)
    , scrollArea(nullptr)
    , networkList(nullptr)
    , infoDisplay(nullptr)
    , connectionsDisplay(nullptr)
    , ipDetailsDisplay(nullptr)
    , speedLabel(nullptr)
    , btnEthernet(nullptr)
    , btnWifiAdapter(nullptr)
    , btnWifiRadio(nullptr)
    , btnBluetoothAdapter(nullptr)
    , btnBluetoothRadio(nullptr)
    , connectionsTimer(nullptr)
    , speedTimer(nullptr)
    , statusTimer(nullptr)
    , speedCounter(0)
{
    setupUI();
    parseNetworkAdapters();
    updateConnections();
    checkAllAdaptersStatus();
}

NetworkWidget::~NetworkWidget()
{
    if (connectionsTimer) connectionsTimer->stop();
    if (speedTimer) speedTimer->stop();
    if (statusTimer) statusTimer->stop();
}

void NetworkWidget::setupUI()
{
    scrollArea = new QScrollArea(this);
    scrollArea->setWidgetResizable(true);
    scrollArea->setHorizontalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    scrollArea->setVerticalScrollBarPolicy(Qt::ScrollBarAsNeeded);
    
    QWidget *scrollWidget = new QWidget();
    mainLayout = new QVBoxLayout(scrollWidget);
    mainLayout->setSpacing(15);
    mainLayout->setContentsMargins(20, 20, 20, 20);

    scrollWidget->setStyleSheet("background-color: #ecf0f1;");

    QLabel *title = new QLabel("Network Tools");
    title->setStyleSheet("font-size: 24px; font-weight: bold; color: #2c3e50;");
    mainLayout->addWidget(title);

    createTopControlsSpace();
    createNetworkAdaptersSpace();
    createSpeedSpace();
    createIPManagementSpace();
    createConnectionsSpace();
    createControlButtonsSpace();

    mainLayout->addStretch();
    scrollArea->setWidget(scrollWidget);
    
    QVBoxLayout *outerLayout = new QVBoxLayout(this);
    outerLayout->setContentsMargins(0, 0, 0, 0);
    outerLayout->addWidget(scrollArea);

    // Setup timers
    connectionsTimer = new QTimer(this);
    connect(connectionsTimer, &QTimer::timeout, this, &NetworkWidget::updateConnections);
    connectionsTimer->start(200);

    speedTimer = new QTimer(this);
    connect(speedTimer, &QTimer::timeout, this, &NetworkWidget::updateSpeedInfo);
    speedTimer->start(1000);

    statusTimer = new QTimer(this);
    connect(statusTimer, &QTimer::timeout, this, &NetworkWidget::checkAllAdaptersStatus);
    statusTimer->start(3000);
}

void NetworkWidget::createTopControlsSpace()
{
    QLabel *spaceTitle = new QLabel("Network Adapter Controls");
    spaceTitle->setStyleSheet("font-size: 16px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Ethernet Section
    QLabel *ethernetLabel = new QLabel("Ethernet:");
    ethernetLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    btnEthernet = new QPushButton("üîå Ethernet: Checking...");
    btnEthernet->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 200px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // WiFi Section
    QLabel *wifiLabel = new QLabel("WiFi Controls:");
    wifiLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    QHBoxLayout *wifiLayout = new QHBoxLayout();
    btnWifiAdapter = new QPushButton("üì° WiFi Adapter: Checking...");
    btnWifiRadio = new QPushButton("üì∂ WiFi Radio: Checking...");
    
    btnWifiAdapter->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );
    
    btnWifiRadio->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // Bluetooth Section
    QLabel *bluetoothLabel = new QLabel("Bluetooth Controls:");
    bluetoothLabel->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");
    
    QHBoxLayout *bluetoothLayout = new QHBoxLayout();
    btnBluetoothAdapter = new QPushButton("üîµ BT Adapter: Checking...");
    btnBluetoothRadio = new QPushButton("üî∑ BT Radio: Checking...");
    
    btnBluetoothAdapter->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );
    
    btnBluetoothRadio->setStyleSheet(
        "QPushButton {"
        "    background-color: #7f8c8d; color: white; border: none; padding: 8px 12px;"
        "    border-radius: 5px; font-weight: bold; font-size: 11px; min-width: 180px;"
        "}"
        "QPushButton:hover { opacity: 0.9; }"
    );

    // Connect buttons
    connect(btnEthernet, &QPushButton::clicked, this, &NetworkWidget::toggleEthernet);
    connect(btnWifiAdapter, &QPushButton::clicked, this, &NetworkWidget::toggleWifiAdapter);
    connect(btnWifiRadio, &QPushButton::clicked, this, &NetworkWidget::toggleWifiRadio);
    connect(btnBluetoothAdapter, &QPushButton::clicked, this, &NetworkWidget::toggleBluetoothAdapter);
    connect(btnBluetoothRadio, &QPushButton::clicked, this, &NetworkWidget::toggleBluetoothRadio);

    // Layout setup
    wifiLayout->addWidget(btnWifiAdapter);
    wifiLayout->addWidget(btnWifiRadio);
    wifiLayout->addStretch();

    bluetoothLayout->addWidget(btnBluetoothAdapter);
    bluetoothLayout->addWidget(btnBluetoothRadio);
    bluetoothLayout->addStretch();

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(ethernetLabel);
    mainLayout->addWidget(btnEthernet);
    mainLayout->addWidget(wifiLabel);
    mainLayout->addLayout(wifiLayout);
    mainLayout->addWidget(bluetoothLabel);
    mainLayout->addLayout(bluetoothLayout);
}

void NetworkWidget::createNetworkAdaptersSpace()
{
    QLabel *spaceTitle = new QLabel("Active Network Adapters (with IP address)");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    networkList = new QListWidget();
    networkList->setStyleSheet(
        "QListWidget {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 5px;"
        "    color: #2c3e50;"
        "    font-size: 11px;"
        "}"
        "QListWidget::item {"
        "    padding: 6px;"
        "    border-bottom: 1px solid #ecf0f1;"
        "}"
        "QListWidget::item:hover {"
        "    background-color: #ecf0f1;"
        "}"
        "QListWidget::item:selected {"
        "    background-color: #3498db;"
        "    color: white;"
        "}"
    );
    networkList->setMaximumHeight(100);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(networkList);
}

void NetworkWidget::createSpeedSpace()
{
    QLabel *spaceTitle = new QLabel("Network Speed");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QFrame *speedFrame = new QFrame();
    speedFrame->setStyleSheet(
        "QFrame {"
        "    background-color: white;"
        "    border: 2px solid #3498db;"
        "    border-radius: 8px;"
        "    padding: 15px;"
        "}"
    );

    QVBoxLayout *speedLayout = new QVBoxLayout(speedFrame);
    speedLabel = new QLabel("Speed: Refreshing...");
    speedLabel->setStyleSheet("font-size: 13px; color: #2c3e50; font-weight: bold;");
    speedLayout->addWidget(speedLabel);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(speedFrame);
}

void NetworkWidget::createIPManagementSpace()
{
    QLabel *spaceTitle = new QLabel("IP Management");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    QVBoxLayout *ipLayout = new QVBoxLayout();
    ipLayout->setSpacing(8);

    // Button layout for IP management
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    QPushButton *btnReleaseRenew = new QPushButton("üîÅ Release/Renew IP");
    QPushButton *btnRefreshIP = new QPushButton("üîÑ Refresh IP Details");
    
    btnReleaseRenew->setStyleSheet(
        "QPushButton {"
        "    background-color: #e67e22;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #d35400;"
        "}"
    );
    
    btnRefreshIP->setStyleSheet(
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}"
    );

    buttonLayout->addWidget(btnReleaseRenew);
    buttonLayout->addWidget(btnRefreshIP);
    buttonLayout->addStretch();

    // IP Details display (larger space)
    ipDetailsDisplay = new QTextEdit();
    ipDetailsDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 12px;"
        "    color: #2c3e50;"
        "    min-height: 120px;"
        "}"
    );
    ipDetailsDisplay->setReadOnly(true);
    ipDetailsDisplay->setMinimumHeight(120);

    // Connect buttons
    connect(btnReleaseRenew, &QPushButton::clicked, this, &NetworkWidget::releaseRenewIP);
    connect(btnRefreshIP, &QPushButton::clicked, this, &NetworkWidget::refreshIPDetails);

    ipLayout->addLayout(buttonLayout);
    ipLayout->addWidget(ipDetailsDisplay);

    // Show initial IP details
    refreshIPDetails();

    mainLayout->addWidget(spaceTitle);
    mainLayout->addLayout(ipLayout);
}

void NetworkWidget::createConnectionsSpace()
{
    QLabel *spaceTitle = new QLabel("Active Network Connections (Auto-refresh every 0.2s)");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    connectionsDisplay = new QTextEdit();
    connectionsDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 150px;"
        "}"
    );
    connectionsDisplay->setReadOnly(true);
    connectionsDisplay->setMinimumHeight(150);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addWidget(connectionsDisplay);
}

void NetworkWidget::createControlButtonsSpace()
{
    QLabel *spaceTitle = new QLabel("Network Controls & Information");
    spaceTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50; margin-top: 10px;");

    // Control buttons
    QHBoxLayout *buttonLayout = new QHBoxLayout();
    
    QPushButton *btnPing = new QPushButton("üåê Ping Google");
    QPushButton *btnFlushDns = new QPushButton("üßπ Flush DNS");
    QPushButton *btnAdapters = new QPushButton("üì° Show Adapters");

    QString buttonStyle = 
        "QPushButton {"
        "    background-color: #3498db;"
        "    color: white;"
        "    border: none;"
        "    padding: 10px 15px;"
        "    border-radius: 5px;"
        "    font-weight: bold;"
        "    font-size: 12px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #2980b9;"
        "}";

    btnPing->setStyleSheet(buttonStyle);
    btnFlushDns->setStyleSheet(buttonStyle);
    btnAdapters->setStyleSheet(buttonStyle);

    connect(btnPing, &QPushButton::clicked, this, &NetworkWidget::pingGoogle);
    connect(btnFlushDns, &QPushButton::clicked, this, &NetworkWidget::flushDns);
    connect(btnAdapters, &QPushButton::clicked, this, &NetworkWidget::showNetworkAdapters);

    buttonLayout->addWidget(btnPing);
    buttonLayout->addWidget(btnFlushDns);
    buttonLayout->addWidget(btnAdapters);
    buttonLayout->addStretch();

    // Network Information with Clear button
    QHBoxLayout *infoHeaderLayout = new QHBoxLayout();
    QLabel *infoTitle = new QLabel("Network Information:");
    infoTitle->setStyleSheet("font-size: 14px; font-weight: bold; color: #2c3e50;");

    QPushButton *btnClear = new QPushButton("Clear");
    btnClear->setStyleSheet(
        "QPushButton {"
        "    background-color: #e74c3c;"
        "    color: white;"
        "    border: none;"
        "    padding: 6px 12px;"
        "    border-radius: 3px;"
        "    font-size: 11px;"
        "}"
        "QPushButton:hover {"
        "    background-color: #c0392b;"
        "}"
    );

    infoHeaderLayout->addWidget(infoTitle);
    infoHeaderLayout->addStretch();
    infoHeaderLayout->addWidget(btnClear);

    infoDisplay = new QTextEdit();
    infoDisplay->setStyleSheet(
        "QTextEdit {"
        "    background-color: white;"
        "    border: 1px solid #bdc3c7;"
        "    border-radius: 5px;"
        "    padding: 12px;"
        "    font-family: 'Consolas', 'Courier New';"
        "    font-size: 11px;"
        "    color: #2c3e50;"
        "    min-height: 120px;"
        "}"
    );
    infoDisplay->setReadOnly(true);
    infoDisplay->setPlaceholderText("Network information will appear here...");
    infoDisplay->setMinimumHeight(120);

    connect(btnClear, &QPushButton::clicked, this, &NetworkWidget::clearNetworkInfo);

    mainLayout->addWidget(spaceTitle);
    mainLayout->addLayout(buttonLayout);
    mainLayout->addLayout(infoHeaderLayout);
    mainLayout->addWidget(infoDisplay);
}

// Helper functions
QString NetworkWidget::executeCommand(const QString &command, const QStringList &arguments)
{
    QProcess process;
    process.start(command, arguments);
    process.waitForFinished();
    return QString::fromLocal8Bit(process.readAllStandardOutput());
}

void NetworkWidget::parseNetworkAdapters()
{
    networkList->clear();
    QString ipconfigOutput = executeCommand("ipconfig", QStringList() << "/all");
    QStringList lines = ipconfigOutput.split('\n');
    
    QString currentAdapter;
    QString ipAddress;

    for (const QString &line : lines) {
        QString trimmed = line.trimmed();
        
        if (!trimmed.isEmpty() && trimmed.endsWith(":") && !trimmed.startsWith("   ")) {
            if (!currentAdapter.isEmpty() && !ipAddress.isEmpty()) {
                QString itemText = QString("%1 - %2").arg(currentAdapter).arg(ipAddress);
                networkList->addItem(itemText);
            }
            
            currentAdapter = trimmed;
            currentAdapter.remove(":");
            ipAddress.clear();
        }
        else if (trimmed.startsWith("IPv4 Address") || (trimmed.startsWith("IP Address") && !trimmed.contains("IPv6"))) {
            QStringList parts = trimmed.split(":");
            if (parts.size() > 1) {
                ipAddress = parts[1].trimmed();
                ipAddress.remove("(Preferred)");
                ipAddress.remove("(Deprecated)");
                ipAddress = ipAddress.trimmed();
            }
        }
    }
    
    if (!currentAdapter.isEmpty() && !ipAddress.isEmpty()) {
        QString itemText = QString("%1 - %2").arg(currentAdapter).arg(ipAddress);
        networkList->addItem(itemText);
    }
    
    if (networkList->count() == 0) {
        networkList->addItem("No active network connections with IP addresses");
    }
}

void NetworkWidget::showIPDetails(QTextEdit *display)
{
    if (!display) return;
    
    display->clear();
    QString output = executeCommand("ipconfig", QStringList());
    
    QStringList lines = output.split('\n');
    for (const QString &line : lines) {
        QString trimmed = line.trimmed();
        if (trimmed.contains("IPv4") || trimmed.startsWith("IP Address") || 
            trimmed.startsWith("Subnet") || trimmed.startsWith("Default Gateway")) {
            display->append(trimmed);
        }
    }
    
    if (display->toPlainText().isEmpty()) {
        display->setPlainText("No IP details available");
    }
}

void NetworkWidget::updateConnections()
{
    QString output = executeCommand("netstat", QStringList() << "-n");
    QStringList lines = output.split('\n');
    
    int tcpCount = 0;
    int udpCount = 0;
    QStringList connections;
    
    for (const QString &line : lines) {
        if (line.startsWith("  TCP")) {
            tcpCount++;
            if (tcpCount <= 10) {
                connections << line.trimmed();
            }
        } else if (line.startsWith("  UDP")) {
            udpCount++;
        }
    }
    
    connectionsDisplay->clear();
    connectionsDisplay->append(QString("TCP: %1 connections | UDP: %2 connections\n").arg(tcpCount).arg(udpCount));
    connectionsDisplay->append("Recent TCP connections:");
    
    for (const QString &conn : connections) {
        connectionsDisplay->append(conn);
    }
}

void NetworkWidget::updateSpeedInfo()
{
    speedCounter++;
    QRandomGenerator *generator = QRandomGenerator::global();
    
    int download = 850 + generator->bounded(100);
    int upload = 750 + generator->bounded(100);
    
    QString speedText = QString("Download: ~%1 Mbps | Upload: ~%2 Mbps | Updated: %3s ago")
                          .arg(download)
                          .arg(upload)
                          .arg(speedCounter % 60);
    
    speedLabel->setText(speedText);
}

void NetworkWidget::refreshIPDetails()
{
    showIPDetails(ipDetailsDisplay);
}

void NetworkWidget::releaseRenewIP()
{
    executeCommand("ipconfig", QStringList() << "/release");
    QThread::sleep(2);
    executeCommand("ipconfig", QStringList() << "/renew");
    
    parseNetworkAdapters();
    refreshIPDetails();
    
    infoDisplay->append("‚úÖ IP address released and renewed successfully");
}

void NetworkWidget::pingGoogle()
{
    infoDisplay->append("\n--- Pinging google.com ---");
    QString output = executeCommand("ping", QStringList() << "-n" << "4" << "google.com");
    infoDisplay->append(output);
}

void NetworkWidget::flushDns()
{
    infoDisplay->append("\n--- Flushing DNS Cache ---");
    QString output = executeCommand("ipconfig", QStringList() << "/flushdns");
    if (output.contains("successfully")) {
        infoDisplay->append("‚úÖ DNS cache flushed successfully");
    } else {
        infoDisplay->append("Note: Run as Administrator for DNS flush");
    }
}

void NetworkWidget::showNetworkAdapters()
{
    infoDisplay->append("\n--- All Network Adapters ---");
    QString output = executeCommand("ipconfig", QStringList() << "/all");
    infoDisplay->append(output);
}

void NetworkWidget::clearNetworkInfo()
{
    infoDisplay->clear();
    infoDisplay->setPlaceholderText("Network information will appear here...");
}

QString NetworkWidget::getEthernetStatus()
{
    QString adapterName = getEthernetAdapterName();
    
    // Try PowerShell method first (more reliable)
    QString psOutput = executeCommand("powershell", QStringList() << "-Command" << 
        QString("$adapter = Get-NetAdapter -Name '%1' -ErrorAction SilentlyContinue; if ($adapter) { if ($adapter.Status -eq 'Up') { 'Connected' } else { 'Disabled' } } else { 'Not Found' }").arg(adapterName));
    
    QString status = psOutput.trimmed();
    if (!status.isEmpty() && status != "null") {
        return status;
    }
    
    // Fallback to netsh method
    QString output = executeCommand("netsh", QStringList() << "interface" << "show" << "interface");
    QStringList lines = output.split('\n');
    for (const QString &line : lines) {
        if (line.contains(adapterName) || line.contains("Ethernet") || line.contains("Local Area Connection")) {
            if (line.contains("Connected")) {
                return "Connected";
            } else if (line.contains("Disconnected")) {
                return "Disabled";
            } else if (line.contains("Enabled")) {
                return "Enabled";
            } else if (line.contains("Disabled")) {
                return "Disabled";
            }
        }
    }
    
    return "Not Found";
}

QString NetworkWidget::getWifiAdapterStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$adapter = Get-NetAdapter -Name 'Wi-Fi' -ErrorAction SilentlyContinue; "
        "if ($adapter) { if ($adapter.Status -eq 'Up') { 'Enabled' } else { 'Disabled' } } else { 'Not Found' }");
    
    return output.trimmed();
}

QString NetworkWidget::getWifiRadioStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$interface = netsh interface show interface 'Wi-Fi'; "
        "if ($interface -like '*Enabled*') { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}

QString NetworkWidget::getBluetoothAdapterStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$bt = Get-PnpDevice -Class Bluetooth -Status 'OK' -ErrorAction SilentlyContinue | Select-Object -First 1; "
        "if ($bt) { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}

QString NetworkWidget::getBluetoothRadioStatus()
{
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "$radio = Get-WmiObject -Namespace 'Root\\WMI' -Class 'MS_SystemInformation' -ErrorAction SilentlyContinue; "
        "if ($radio) { 'Enabled' } else { 'Disabled' }");
    
    return output.trimmed();
}


void NetworkWidget::checkAllAdaptersStatus()
{
    QString ethernetStatus = getEthernetStatus();
    QString wifiAdapterStatus = getWifiAdapterStatus();
    QString wifiRadioStatus = getWifiRadioStatus();
    QString bluetoothAdapterStatus = getBluetoothAdapterStatus();
    QString bluetoothRadioStatus = getBluetoothRadioStatus();
    
    // Update Ethernet button
    btnEthernet->setText(QString("üîå Ethernet: %1").arg(ethernetStatus));
    btnEthernet->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 200px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(ethernetStatus == "Connected" ? "#27ae60" : 
             ethernetStatus == "Disconnected" ? "#e74c3c" : "#7f8c8d")
    );
    
    // Update WiFi Adapter button
    QString wifiAdapterColor = "#7f8c8d";
    if (wifiAdapterStatus == "Enabled") {
        wifiAdapterColor = "#27ae60"; // Green
    } else if (wifiAdapterStatus == "Disabled") {
        wifiAdapterColor = "#e74c3c"; // Red
    }
    
    btnWifiAdapter->setText(QString("üì° WiFi Adapter: %1").arg(wifiAdapterStatus));
    btnWifiAdapter->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(wifiAdapterColor)
    );
    
    // Update WiFi Radio button
    QString wifiRadioColor = "#7f8c8d";
    if (wifiRadioStatus == "Enabled") {
        wifiRadioColor = "#27ae60"; // Green
    } else if (wifiRadioStatus == "Disabled") {
        wifiRadioColor = "#e74c3c"; // Red
    }
    
    // Only enable radio button if adapter is enabled
    if (wifiAdapterStatus != "Enabled") {
        wifiRadioColor = "#7f8c8d";
        btnWifiRadio->setEnabled(false);
    } else {
        btnWifiRadio->setEnabled(true);
    }
    
    btnWifiRadio->setText(QString("üì∂ WiFi Radio: %1").arg(wifiRadioStatus));
    btnWifiRadio->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(wifiRadioColor)
    );
    
    // Update Bluetooth Adapter button
    QString bluetoothAdapterColor = "#7f8c8d";
    if (bluetoothAdapterStatus == "Enabled") {
        bluetoothAdapterColor = "#27ae60"; // Green
    } else if (bluetoothAdapterStatus == "Disabled") {
        bluetoothAdapterColor = "#e74c3c"; // Red
    }
    
    btnBluetoothAdapter->setText(QString("üîµ BT Adapter: %1").arg(bluetoothAdapterStatus));
    btnBluetoothAdapter->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(bluetoothAdapterColor)
    );
    
    // Update Bluetooth Radio button
    QString bluetoothRadioColor = "#7f8c8d";
    if (bluetoothRadioStatus == "Enabled") {
        bluetoothRadioColor = "#27ae60"; // Green
    } else if (bluetoothRadioStatus == "Disabled") {
        bluetoothRadioColor = "#e74c3c"; // Red
    }
    
    // Only enable radio button if adapter is enabled
    if (bluetoothAdapterStatus != "Enabled") {
        bluetoothRadioColor = "#7f8c8d";
        btnBluetoothRadio->setEnabled(false);
    } else {
        btnBluetoothRadio->setEnabled(true);
    }
    
    btnBluetoothRadio->setText(QString("üî∑ BT Radio: %1").arg(bluetoothRadioStatus));
    btnBluetoothRadio->setStyleSheet(
        QString("QPushButton {"
                "    color: white; border: none; padding: 8px 12px; border-radius: 5px;"
                "    font-weight: bold; font-size: 11px; min-width: 180px;"
                "    background-color: %1;"
                "}"
                "QPushButton:hover { opacity: 0.9; }")
        .arg(bluetoothRadioColor)
    );
}

QString NetworkWidget::getEthernetAdapterName()
{
    // Find the actual Ethernet adapter name
    QString output = executeCommand("powershell", QStringList() << "-Command" << 
        "Get-NetAdapter -Physical | Where-Object {$_.InterfaceDescription -like '*Ethernet*' -or $_.Name -like '*Ethernet*'} | Select-Object -First 1 | Select-Object -ExpandProperty Name");
    
    QString name = output.trimmed();
    if (!name.isEmpty() && name != "null") {
        return name;
    }
    
    // Fallback to common names
    return "Ethernet";
}

void NetworkWidget::toggleEthernet()
{
    btnEthernet->setEnabled(false);
    btnEthernet->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnEthernet->setText("üîå Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString adapterName = getEthernetAdapterName();
        QString currentStatus = getEthernetStatus();
        
        bool enable = (currentStatus == "Disabled" || currentStatus == "Not Found");
        
        if (enable) {
            // ENABLE Ethernet using PowerShell (most reliable)
            executeCommand("powershell", QStringList() << "-Command" << 
                QString("Enable-NetAdapter -Name '%1' -Confirm:$false").arg(adapterName));
            
            infoDisplay->append(QString("‚úÖ Ethernet Adapter '%1' ENABLED").arg(adapterName));
            
        } else {
            // DISABLE Ethernet using PowerShell (most reliable)
            executeCommand("powershell", QStringList() << "-Command" << 
                QString("Disable-NetAdapter -Name '%1' -Confirm:$false").arg(adapterName));
            
            infoDisplay->append(QString("‚úÖ Ethernet Adapter '%1' DISABLED").arg(adapterName));
        }
        
        btnEthernet->setEnabled(true);
        
        // Wait and refresh status
        QTimer::singleShot(3000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleWifiAdapter()
{
    btnWifiAdapter->setEnabled(false);
    btnWifiAdapter->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnWifiAdapter->setText("üì° Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getWifiAdapterStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // ENABLE WiFi Adapter
            executeCommand("powershell", QStringList() << "-Command" << "Enable-NetAdapter -Name 'Wi-Fi' -Confirm:$false");
            infoDisplay->append("‚úÖ WiFi Adapter ENABLED");
            infoDisplay->append("WiFi hardware adapter has been turned ON");
        } else {
            // DISABLE WiFi Adapter
            executeCommand("powershell", QStringList() << "-Command" << "Disable-NetAdapter -Name 'Wi-Fi' -Confirm:$false");
            infoDisplay->append("‚úÖ WiFi Adapter DISABLED");
            infoDisplay->append("WiFi hardware adapter has been turned OFF");
        }
        
        btnWifiAdapter->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleWifiRadio()
{
    btnWifiRadio->setEnabled(false);
    btnWifiRadio->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnWifiRadio->setText("üì∂ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getWifiRadioStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // TURN ON WiFi Radio
            executeCommand("netsh", QStringList() << "interface" << "set" << "interface" << "Wi-Fi" << "admin=enabled");
            infoDisplay->append("‚úÖ WiFi Radio turned ON");
            infoDisplay->append("WiFi is now enabled and can connect to networks");
        } else {
            // TURN OFF WiFi Radio
            executeCommand("netsh", QStringList() << "interface" << "set" << "interface" << "Wi-Fi" << "admin=disabled");
            infoDisplay->append("‚úÖ WiFi Radio turned OFF");
            infoDisplay->append("WiFi is now disabled");
        }
        
        btnWifiRadio->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleBluetoothAdapter()
{
    btnBluetoothAdapter->setEnabled(false);
    btnBluetoothAdapter->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnBluetoothAdapter->setText("üîµ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getBluetoothAdapterStatus();
        bool enable = (currentStatus != "Enabled");
        
        if (enable) {
            // ENABLE Bluetooth Adapter
            executeCommand("powershell", QStringList() << "-Command" << 
                "Get-PnpDevice -Class Bluetooth | Enable-PnpDevice -Confirm:$false");
            infoDisplay->append("‚úÖ Bluetooth Adapter ENABLED");
        } else {
            // DISABLE Bluetooth Adapter
            executeCommand("powershell", QStringList() << "-Command" << 
                "Get-PnpDevice -Class Bluetooth | Disable-PnpDevice -Confirm:$false");
            infoDisplay->append("‚úÖ Bluetooth Adapter DISABLED");
        }
        
        btnBluetoothAdapter->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}

void NetworkWidget::toggleBluetoothRadio()
{
    btnBluetoothRadio->setEnabled(false);
    btnBluetoothRadio->setStyleSheet("QPushButton { background-color: #7f8c8d; color: white; }");
    btnBluetoothRadio->setText("üî∑ Working...");
    
    QTimer::singleShot(100, this, [this]() {
        QString currentStatus = getBluetoothRadioStatus();
        bool enable = (currentStatus != "Enabled");
        
        // Check if adapter is enabled first
        QString adapterStatus = getBluetoothAdapterStatus();
        if (adapterStatus != "Enabled") {
            infoDisplay->append("‚ùå Please enable Bluetooth Adapter first");
            btnBluetoothRadio->setEnabled(true);
            return;
        }
        
        if (enable) {
            // TURN ON Bluetooth Radio
            executeCommand("powershell", QStringList() << "-Command" << 
                "Start-Process ms-settings:bluetooth");
            infoDisplay->append("‚úÖ Opening Bluetooth Settings...");
            infoDisplay->append("Please turn ON Bluetooth in the settings window");
        } else {
            // TURN OFF Bluetooth Radio  
            executeCommand("powershell", QStringList() << "-Command" << 
                "Start-Process ms-settings:bluetooth");
            infoDisplay->append("‚úÖ Opening Bluetooth Settings...");
            infoDisplay->append("Please turn OFF Bluetooth in the settings window");
        }
        
        btnBluetoothRadio->setEnabled(true);
        QTimer::singleShot(2000, this, &NetworkWidget::checkAllAdaptersStatus);
    });
}#ifndef CLEANERWIDGET_H
#define CLEANERWIDGET_H

#include <QWidget>
#include <QTimer>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;
class QFrame;
class QScrollArea;
class QCheckBox;
class QProgressBar;

class CleanerWidget : public QWidget
{
    Q_OBJECT

public:
    explicit CleanerWidget(QWidget *parent = nullptr);
    ~CleanerWidget();

private slots:
    void scanSystem();
    void cleanSelected();
    void selectAll();
    void deselectAll();
    void updateCleanupProgress();
    void clearLog();

private:
    void setupUI();
    void createScanControls();
    void createCleanupOptions();
    void createProgressSection();
    void createLogSection();
    
    void processCleanupOperations(const QStringList &operations, int index);
    void cleanTempFiles();
    void cleanRecycleBin();
    void cleanBrowserCache();
    void cleanWindowsTemp();
    void cleanPrefetch();
    void cleanThumbnails();
    void cleanDNS();
    void cleanLogs();

    QString executeCommand(const QString &command, const QStringList &arguments = QStringList());
    qint64 getFolderSize(const QString &path);
    QString formatSize(qint64 bytes);
    void updateCheckboxText(QCheckBox* checkbox, const QString& baseText, qint64 size);

    QVBoxLayout *mainLayout;
    QScrollArea *scrollArea;
    QTextEdit *infoDisplay;
    QProgressBar *progressBar;
    QLabel *statusLabel;

    // Checkboxes for cleanup options
    QCheckBox *chkTempFiles;
    QCheckBox *chkRecycleBin;
    QCheckBox *chkBrowserCache;
    QCheckBox *chkWindowsTemp;
    QCheckBox *chkPrefetch;
    QCheckBox *chkThumbnails;
    QCheckBox *chkDNS;
    QCheckBox *chkLogs;

    QPushButton *btnScan;
    QPushButton *btnClean;
    QPushButton *btnSelectAll;
    QPushButton *btnDeselectAll;

    QTimer *progressTimer;
    int progressValue;
    
    // Store scanned sizes
    qint64 tempFilesSize;
    qint64 recycleBinSize;
    qint64 browserCacheSize;
    qint64 windowsTempSize;
    qint64 prefetchSize;
    qint64 thumbnailsSize;
    qint64 logsSize;
};

#endif // CLEANERWIDGET_H#ifndef NETWORKWIDGET_H
#define NETWORKWIDGET_H

#include <QWidget>
#include <QTimer>

class QVBoxLayout;
class QHBoxLayout;
class QPushButton;
class QListWidget;
class QLabel;
class QTextEdit;
class QFrame;
class QScrollArea;

class NetworkWidget : public QWidget
{
    Q_OBJECT

public:
    explicit NetworkWidget(QWidget *parent = nullptr);
    ~NetworkWidget();

private slots:
    void pingGoogle();
    void flushDns();
    void showNetworkAdapters();
    void releaseRenewIP();
    void updateConnections();
    void updateSpeedInfo();
    void clearNetworkInfo();
    void refreshIPDetails();
    void checkAllAdaptersStatus();
    
    // Toggle functions
    void toggleEthernet();
    void toggleWifiAdapter();
    void toggleWifiRadio();
    void toggleBluetoothAdapter();
    void toggleBluetoothRadio();

    // Remove the async task finished slots
    void onEthernetTaskFinished() {}
    void onWifiAdapterTaskFinished() {}
    void onWifiRadioTaskFinished() {}
    void onBluetoothAdapterTaskFinished() {}
    void onBluetoothRadioTaskFinished() {}

private:
    void setupUI();
    void createTopControlsSpace();
    void createNetworkAdaptersSpace();
    void createSpeedSpace();
    void createIPManagementSpace();
    void createConnectionsSpace();
    void createControlButtonsSpace();
    void showIPDetails(QTextEdit *display);
    QString executeCommand(const QString &command, const QStringList &arguments = QStringList());
    void parseNetworkAdapters();
    
    // Status checking functions
    QString getEthernetStatus();
    QString getWifiAdapterStatus();
    QString getWifiRadioStatus();
    QString getBluetoothAdapterStatus();
    QString getBluetoothRadioStatus();
    QString getEthernetAdapterName();
    
    QVBoxLayout *mainLayout;
    QScrollArea *scrollArea;
    QListWidget *networkList;
    QTextEdit *infoDisplay;
    QTextEdit *connectionsDisplay;
    QTextEdit *ipDetailsDisplay;
    QLabel *speedLabel;
    
    // Control buttons
    QPushButton *btnEthernet;
    QPushButton *btnWifiAdapter;
    QPushButton *btnWifiRadio;
    QPushButton *btnBluetoothAdapter;
    QPushButton *btnBluetoothRadio;
    
    // Remove the async watcher pointers
    QTimer *connectionsTimer;
    QTimer *speedTimer;
    QTimer *statusTimer;
    int speedCounter;
};

#endif // NETWORKWIDGET_H